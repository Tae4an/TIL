# AWS Secrets Manager란?

## 개념 정의
**AWS Secrets Manager**는 AWS에서 제공하는 **완전 관리형 시크릿 관리 서비스**다. 데이터베이스 자격 증명, API 키, OAuth 토큰, 애플리케이션 암호 등 민감한 정보를 안전하게 저장, 관리, 검색하고 자동으로 순환할 수 있다.

간단히 말해 **"클라우드 기반의 디지털 금고"** 로, 하드코딩된 자격 증명을 제거하고 런타임에 동적으로 시크릿을 검색할 수 있게 하는 중앙 집중식 보안 관리 플랫폼 역할을 한다.

## 핵심 특징

### **완전 관리형 보안**
- **강력한 암호화**: AWS KMS를 사용한 AES-256 암호화로 저장 시 및 전송 중 데이터 보호
- **엔벨로프 암호화**: 플레인텍스트 데이터 키와 암호화된 키를 분리하여 추가 보안 계층 제공
- **TLS 전송**: 모든 시크릿 검색 시 안전한 TLS 연결을 통한 전송

### **자동 시크릿 순환**
- **스케줄 기반 순환**: 정해진 일정에 따라 자동으로 자격 증명 업데이트
- **네이티브 지원**: RDS, DocumentDB, Redshift 등 AWS 데이터베이스 서비스와 완벽 통합
- **Lambda 함수**: 사용자 정의 Lambda 함수로 타사 서비스 시크릿 순환 확장 가능

### **세밀한 접근 제어**
- **IAM 통합**: AWS IAM을 통한 리소스별, 사용자별 세부 권한 관리
- **최소 권한 원칙**: 필요한 시크릿에만 접근할 수 있도록 권한 최소화
- **다단계 인증**: MFA 토큰, 액세스 키, 암호를 통한 강화된 인증

### **AWS 서비스와의 완벽한 통합**
- **RDS/Aurora**: 데이터베이스 자격 증명 자동 관리 및 순환
- **Lambda**: 시크릿 검색을 위한 런타임 API 호출
- **ECS/EKS**: 컨테이너 환경에서 안전한 시크릿 주입

## 주요 구성 요소

### **시크릿 (Secret)**
- **최대 64KB** JSON 문서로 저장되는 민감한 정보 컨테이너
- 사용자명, 암호, 연결 세부 정보 등을 포함한 자격 증명 세트
- 버전 관리를 통한 이전 시크릿으로의 롤백 지원

### **메타데이터**
- **기본 정보**: 시크릿명, 설명, ARN 등 식별 정보
- **KMS 키 정보**: 암호화/복호화에 사용되는 AWS KMS 키 ARN
- **순환 설정**: 순환 주기 및 Lambda 함수 정보
- **태그**: 비용 할당 및 리소스 구성을 위한 키-값 쌍

### **순환 함수**
- **AWS Lambda**: 시크릿 순환 로직을 실행하는 서버리스 함수
- **네이티브 템플릿**: RDS, DocumentDB 등을 위한 사전 구성된 함수
- **사용자 정의**: 타사 서비스 통합을 위한 커스텀 Lambda 함수

## 하드코딩 vs Secrets Manager 비교

| 특징 | Secrets Manager | 하드코딩된 자격 증명 |
|------|-----------------|---------------------|
| **보안성** | KMS 암호화 + IAM 제어 | 소스 코드에 노출 |
| **순환** | 자동 순환 지원 | 수동 코드 변경 필요 |
| **접근 제어** | 세밀한 IAM 정책 | 코드 접근 = 자격 증명 접근 |
| **감사** | CloudTrail 통합 | 추적 불가능 |
| **운영** | 무중단 업데이트 | 애플리케이션 재배포 필요 |
| **컴플라이언스** | 규정 준수 지원 | 보안 위험 높음 |

## 주요 기능

### **다중 리전 복제**
- **자동 복제**: 지정된 여러 AWS 리전으로 시크릿 자동 복제
- **재해 복구**: 교차 리전 중복성으로 비즈니스 연속성 보장
- **읽기 전용 복제본**: 기본 시크릿과 동기화되는 리전별 복제본

### **시크릿 관리 작업**
- **생성 및 수정**: 콘솔, SDK, CLI를 통한 시크릿 생성 및 업데이트
- **검색 및 삭제**: 필요 시 시크릿 찾기 및 안전한 삭제
- **복원**: 삭제된 시크릿의 복구 기능

### **모니터링 및 감사**
- **CloudWatch 통합**: 시크릿 사용 패턴 및 성능 메트릭 모니터링
- **CloudTrail 로깅**: 모든 시크릿 접근 및 변경 사항 감사 기록
- **알림 서비스**: 시크릿 순환 실패 등에 대한 자동 알림

## 주요 활용 사례

### **데이터베이스 자격 증명 관리**
- RDS, Aurora, DocumentDB 등의 데이터베이스 암호 자동 순환
- 애플리케이션 재시작 없이 자격 증명 업데이트
- 개발/스테이징/프로덕션 환경별 자격 증명 분리

### **API 키 및 토큰 관리**
- 타사 서비스 API 키 안전한 저장
- OAuth 리프레시 토큰 자동 갱신
- 마이크로서비스 간 인증 토큰 관리

### **애플리케이션 구성 관리**
- 환경별 구성 정보 중앙 집중 관리
- 컨테이너 환경에서 런타임 시크릿 주입
- CI/CD 파이프라인에서 안전한 배포 자격 증명 사용

## 기본 워크플로

### **1. 시크릿 생성**
```bash
# AWS CLI로 데이터베이스 시크릿 생성
aws secretsmanager create-secret \
    --name "prod/mysql/admin" \
    --description "Production MySQL credentials" \
    --secret-string '{"username":"admin","password":"mypassword","host":"db.example.com","port":"3306"}'
```

### **2. 자동 순환 설정**
```bash
# RDS 데이터베이스 자동 순환 활성화
aws secretsmanager rotate-secret \
    --secret-id "prod/mysql/admin" \
    --rotation-rules AutomaticallyAfterDays=30
```

### **3. 애플리케이션에서 시크릿 검색**
```python
import boto3
import json

# Secrets Manager 클라이언트 생성
client = boto3.client('secretsmanager', region_name='us-west-2')

# 시크릿 검색
response = client.get_secret_value(SecretId='prod/mysql/admin')
secret = json.loads(response['SecretString'])

# 데이터베이스 연결에 사용
db_host = secret['host']
db_user = secret['username']
db_pass = secret['password']
```

### **4. IAM 권한 설정**
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "secretsmanager:GetSecretValue",
            "Resource": "arn:aws:secretsmanager:us-west-2:123456789012:secret:prod/mysql/admin-*"
        }
    ]
}
```

## 비용 구조

### **시크릿 저장 비용**
- **시크릿당 월 $0.40**: 저장된 각 시크릿에 대한 기본 요금
- **복제본 비용**: 추가 리전으로 복제 시 리전당 동일 요금 적용

### **API 호출 비용**
- **10,000개 요청당 $0.05**: GetSecretValue 등 API 호출 요금
- **무료 티어**: 월 10,000개 API 호출까지 무료

### **순환 비용**
- **Lambda 실행**: 순환 함수 실행에 따른 Lambda 요금 별도
- **네트워크**: 데이터 전송 비용은 표준 AWS 요금 적용

## 보안 모범 사례

### **최소 권한 원칙**
- **리소스별 권한**: 특정 시크릿에만 접근할 수 있는 IAM 정책 생성
- **시간 제한**: 임시 자격 증명 사용으로 노출 위험 최소화
- **정기 검토**: 접근 권한 정기적 감사 및 불필요한 권한 제거

### **암호화 관리**
- **고객 관리 키**: AWS KMS 고객 관리 키로 추가 제어
- **키 순환**: KMS 키 자동 순환 활성화로 보안 강화
- **교차 계정**: 다른 AWS 계정과 시크릿 공유 시 명시적 권한 부여

### **운영 보안**
- **정기 순환**: 모든 시크릿에 대한 자동 순환 일정 설정
- **모니터링**: CloudWatch 및 CloudTrail로 이상 활동 감지
- **백업**: 중요 시크릿의 교차 리전 복제로 가용성 보장

Secrets Manager는 **현대적인 애플리케이션 보안의 핵심**으로, 하드코딩된 자격 증명을 제거하고 자동화된 시크릿 관리를 통해 보안 태세를 크게 향상시키는 필수 서비스다.
