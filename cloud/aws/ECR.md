# AWS ECR이란?

## 개념 정의
**AWS ECR(Elastic Container Registry)** 는 AWS에서 제공하는 **완전 관리형 컨테이너 이미지 레지스트리 서비스**다. Docker 이미지, OCI 이미지 및 아티팩트를 안전하고 확장 가능하며 신뢰성 있게 저장, 관리, 배포할 수 있다.

간단히 말해 **"AWS 버전의 Docker Hub"** 로, 컨테이너 이미지를 위한 중앙 집중식 저장소 역할을 한다.

## 핵심 특징

### **완전 관리형 서비스**
- **인프라 관리 불필요**: AWS가 레지스트리의 가용성, 확장성, 보안을 모두 관리
- **고가용성**: S3 기반으로 99.999999999%(11개의 9) 내구성 제공
- **자동 확장**: 사용량에 따라 자동으로 확장되어 용량 제한 없음

### **강력한 보안**
- **IAM 통합**: AWS IAM을 통한 세밀한 액세스 제어
- **이미지 스캔**: 푸시 시 자동으로 보안 취약점 검사
- **암호화**: 전송 중(HTTPS) 및 저장 중(AES-256) 데이터 암호화

### **AWS 서비스와의 완벽한 통합**
- **ECS/EKS**: 자동 이미지 배포 및 관리
- **Lambda**: 컨테이너 이미지 기반 Lambda 함수 지원
- **CodePipeline**: CI/CD 파이프라인과의 네이티브 통합

## 주요 구성 요소

### **Registry (레지스트리)**
- **AWS 계정당 하나씩** 자동으로 제공되는 최상위 컨테이너
- URL 형식: `https://aws_account_id.dkr.ecr.region.amazonaws.com`
- 계정 ID가 레지스트리 ID로 사용됨

### **Repository (리포지토리)**
- **이미지를 그룹화하는 단위**로 하나의 애플리케이션/서비스당 하나씩 생성
- 동일 리포지토리 내에서 여러 이미지 버전(태그) 관리
- **네임스페이스 지원**: `team-frontend/app`, `team-backend/api` 등으로 구조화

### **Image (이미지)**
- Docker 이미지, OCI 이미지, OCI 호환 아티팩트 저장
- 각 이미지는 고유한 태그 또는 digest로 식별
- 최대 이미지 크기: **10GB**

## Public vs Private Registry

### **Private Registry**
- 기본 제공되는 프라이빗 레지스트리
- **IAM 인증 필요**: 권한이 있는 사용자만 접근 가능
- 기업 내부 애플리케이션 이미지 저장에 적합

### **Public Registry**
- 공개적으로 접근 가능한 레지스트리
- **Amazon ECR Public Gallery**에서 확인 가능
- 오픈소스 프로젝트나 공개 배포용 이미지에 적합

## 주요 기능

### **이미지 스캔**
- **Enhanced Scanning**: Amazon Inspector와 통합된 고급 스캔
- **Basic Scanning**: Clair 기반 기본 취약점 스캔
- 푸시 시 자동 스캔 또는 수동 스캔 선택 가능
- CVE 데이터베이스 기반 보안 취약점 탐지

### **Lifecycle Policy**
- **자동 정리**: 오래된 이미지나 사용하지 않는 이미지 자동 삭제
- **비용 최적화**: 스토리지 비용 절감을 위한 정책 설정
- JSON 기반 규칙으로 세밀한 제어 가능

### **복제 (Replication)**
- **Cross-Region**: 다른 리전으로 이미지 복제
- **Cross-Account**: 다른 AWS 계정으로 이미지 복제
- 재해 복구 및 글로벌 배포 지원

### **이미지 불변성**
- **Image Immutability**: 동일한 태그로 덮어쓰기 방지
- 실수로 인한 이미지 변경 방지
- 배포 안정성 및 추적성 향상

## Docker Hub vs ECR 비교

| 특징 | ECR | Docker Hub |
|------|-----|------------|
| **관리** | 완전 관리형 | 자체 관리/클라우드 |
| **보안** | IAM 통합 | 개별 계정 관리 |
| **성능** | AWS 내부 최적화 | 인터넷 기반 |
| **비용** | 스토리지+전송 기반 | 무료/유료 플랜 |
| **스캔** | 내장 취약점 스캔 | 유료 기능 |
| **통합** | AWS 서비스 완벽 통합 | 서드파티 도구 필요 |

## 주요 활용 사례

### **마이크로서비스 아키텍처**
- 각 서비스별 독립적인 컨테이너 이미지 관리
- ECS/EKS와 연동한 자동 배포
- 서비스별 버전 관리 및 롤백

### **CI/CD 파이프라인**
- CodeBuild/CodePipeline과 연동한 자동 빌드
- 이미지 스캔을 통한 보안 검증
- 태그 기반 환경별 배포 전략

### **Multi-Region 배포**
- 이미지 복제를 통한 글로벌 서비스 배포
- 각 리전별 빠른 이미지 풀(Pull) 성능
- 재해 복구 및 백업 전략

## 기본 워크플로

### **1. 로컬 개발**
```bash
# ECR 로그인
aws ecr get-login-password --region us-west-2 | \
docker login --username AWS --password-stdin \
123456789012.dkr.ecr.us-west-2.amazonaws.com
```

### **2. 이미지 빌드 및 태그**
```bash
# 이미지 빌드
docker build -t my-app .

# ECR 태그 지정
docker tag my-app:latest \
123456789012.dkr.ecr.us-west-2.amazonaws.com/my-app:latest
```

### **3. 이미지 푸시**
```bash
# ECR로 푸시
docker push \
123456789012.dkr.ecr.us-west-2.amazonaws.com/my-app:latest
```

### **4. 컨테이너 서비스에서 사용**
- ECS 태스크 정의 또는 EKS 파드 스펙에서 ECR 이미지 URL 참조
- 자동으로 이미지 풀 및 컨테이너 실행

## 비용 구조

### **스토리지 비용**
- **GB당 월 $0.10**: 저장된 이미지 크기에 따른 과금
- 압축된 이미지 크기 기준으로 계산

### **데이터 전송 비용**
- **Pull 요청**: 인터넷으로 나가는 데이터 전송 시 과금
- **AWS 내부**: 동일 리전 내 EC2, ECS, EKS 간 전송은 무료

## 보안 모범 사례

### **최소 권한 원칙**
- IAM 정책으로 필요한 리포지토리만 접근 허용
- 개발/운영 환경별 권한 분리
- 크로스 계정 액세스 시 세밀한 권한 설정

### **이미지 보안**
- 정기적인 취약점 스캔 실행
- 베이스 이미지 최신 버전 사용
- 불필요한 패키지 제거로 공격 표면 최소화

### **네트워크 보안**
- VPC 엔드포인트 사용으로 프라이빗 통신
- 보안 그룹으로 네트워크 액세스 제어

ECR은 **AWS 컨테이너 생태계의 핵심**으로, 안전하고 효율적인 컨테이너 이미지 관리를 통해 현대적인 애플리케이션 배포와 운영을 지원하는 필수 서비스다.
