# AWS NACL이란?

## 개념 정의
NACL(Network Access Control List, 네트워크 액세스 제어 목록)은 VPC의 서브넷 레벨에서 인바운드·아웃바운드 트래픽을 제어하는 stateless 방화벽으로, IP 주소 범위·프로토콜·포트 기반으로 트래픽을 허용하거나 차단하는 규칙을 번호 순서대로 평가한다.

쉽게 말해 "서브넷 전체를 보호하는 방화벽으로, 들어오고 나가는 트래픽을 규칙 번호 순서대로 검사해서 허용·차단하며, 인바운드 허용해도 아웃바운드는 별도로 허용해야 하는 무상태(stateless) 보안 계층"이다.

## 핵심 특징

### Stateless (무상태)
인바운드 규칙으로 트래픽을 허용해도 아웃바운드 규칙으로 응답 트래픽을 별도로 허용해야 하며, 연결 상태를 추적하지 않는다.

**예시**: 외부에서 SSH(22번) 접속 허용 시
- 인바운드: 22번 포트 허용
- 아웃바운드: 임시 포트(1024-65535) 허용 필요 (응답 트래픽용)

### 서브넷 레벨 적용
서브넷 내 모든 리소스(EC2, RDS 등)에 자동 적용되며, 하나의 서브넷은 하나의 NACL과만 연결되지만 하나의 NACL은 여러 서브넷에 연결 가능하다.

### 규칙 번호 순서 평가
규칙 번호(1~32766)가 낮은 순서대로 평가하고, 매칭되는 첫 번째 규칙을 적용한 후 나머지는 무시한다.

**예시**
- 규칙 100: 10.0.0.5 → DENY
- 규칙 200: 10.0.0.0/24 → ALLOW
- 결과: 10.0.0.5는 규칙 100에서 차단 (규칙 200은 평가 안 됨)

### ALLOW/DENY 모두 지정 가능
Security Group과 달리 명시적으로 트래픽을 차단(DENY)할 수 있다.

### 기본 NACL
VPC 생성 시 자동으로 기본 NACL이 생성되며, 모든 인바운드·아웃바운드 트래픽을 허용한다. 마지막 규칙(*)은 매칭되지 않은 모든 트래픽을 거부한다.

## NACL 규칙 구성 요소

### Rule Number (규칙 번호)
1~32766 사이 숫자로, 낮은 번호부터 평가된다. 일반적으로 100 단위로 증가시켜 여유를 둔다 (100, 200, 300...).

### Type / Protocol
ALL, TCP, UDP, ICMP 등 프로토콜 타입을 지정한다.

### Port Range
허용·차단할 포트 범위를 지정한다 (예: 80, 443, 1024-65535).

### Source (인바운드) / Destination (아웃바운드)
CIDR 블록으로 트래픽의 출발지(인바운드) 또는 목적지(아웃바운드)를 지정한다.

**예시**
- 0.0.0.0/0: 모든 IP 주소
- 10.0.1.0/24: 특정 서브넷
- 203.0.113.5/32: 특정 단일 IP

### Allow / Deny
트래픽을 허용(ALLOW) 또는 차단(DENY)한다.

## NACL 예시

### 웹 서버 서브넷 NACL

**인바운드 규칙**

| 규칙 번호 | 타입 | 프로토콜 | 포트 범위 | 소스 | Allow/Deny |
|----------|------|---------|----------|------|------------|
| 100 | HTTP | TCP | 80 | 0.0.0.0/0 | ALLOW |
| 110 | HTTPS | TCP | 443 | 0.0.0.0/0 | ALLOW |
| 120 | SSH | TCP | 22 | 203.0.113.0/24 | ALLOW |
| * | ALL | ALL | ALL | 0.0.0.0/0 | DENY |

**아웃바운드 규칙**

| 규칙 번호 | 타입 | 프로토콜 | 포트 범위 | 목적지 | Allow/Deny |
|----------|------|---------|----------|--------|------------|
| 100 | Custom TCP | TCP | 1024-65535 | 0.0.0.0/0 | ALLOW |
| * | ALL | ALL | ALL | 0.0.0.0/0 | DENY |

임시 포트(1024-65535) 아웃바운드 허용은 클라이언트 응답 트래픽용이다.

## NACL vs Security Group

| 항목 | NACL | Security Group |
|------|------|----------------|
| 적용 레벨 | 서브넷 (subnet-level) | 인스턴스·ENI (instance-level) |
| 상태 | Stateless (무상태) | Stateful (상태 유지) |
| 규칙 평가 | 번호 순서대로 평가 | 모든 규칙 평가 |
| 응답 트래픽 | 명시적 허용 필요 | 자동 허용 |
| DENY 규칙 | 지원 | 미지원 (ALLOW만) |
| 기본 동작 | 모든 트래픽 허용 | 모든 인바운드 차단 |
| 적용 범위 | 서브넷 전체 | 지정한 리소스만 |
| 연결 수 | 서브넷당 1개 | 인스턴스당 여러 개 가능 |

**비유**: NACL은 건물 입구 보안(서브넷 경계), Security Group은 사무실 문 보안(인스턴스 경계)

## 주요 활용 사례

### 특정 IP 차단
악성 IP나 공격 IP를 서브넷 레벨에서 차단한다.

**예시**: 규칙 50번에 "10.0.0.100 DENY" 추가 → 해당 IP 전체 서브넷 접근 차단

### 서브넷 간 트래픽 제어
프라이빗 서브넷과 퍼블릭 서브넷 간 트래픽을 제어한다.

**예시**: DB 서브넷 NACL에서 앱 서브넷(10.0.1.0/24)만 3306번 포트 허용

### 방어 계층 추가 (Defense in Depth)
Security Group과 NACL을 함께 사용해 다층 보안을 구현한다.

**예시**
- NACL: 서브넷 레벨에서 의심스러운 IP 차단
- Security Group: 인스턴스 레벨에서 필요한 트래픽만 허용

### 규정 준수
특정 IP 범위만 접근 가능하도록 강제하는 규정 준수 요구사항을 충족한다.

## 모범 사례

### 규칙 번호 간격 유지
100 단위로 증가시켜 나중에 중간에 규칙 추가 여유를 둔다 (100, 200, 300...).

### 임시 포트 허용
아웃바운드 규칙에서 임시 포트(1024-65535) 허용을 빼먹지 않도록 주의한다 (stateless이므로).

### 기본 NACL 수정 지양
기본 NACL을 수정하기보다 커스텀 NACL을 새로 만들어 적용한다.

### Security Group 우선 사용
일반적으로 Security Group을 먼저 사용하고, 추가 보안이 필요한 경우에만 NACL을 사용한다.

### 최소 권한 원칙
필요한 트래픽만 허용하고 나머지는 차단한다.

## 제한 사항

### 규칙 수 제한
NACL당 인바운드·아웃바운드 각각 기본 20개 규칙 (최대 40개까지 증가 요청 가능).

### Stateless로 인한 복잡성
인바운드·아웃바운드 모두 명시적 허용 필요로 설정이 복잡할 수 있다.

### 규칙 순서 관리
규칙 번호 순서를 잘못 설정하면 의도와 다르게 동작할 수 있다.

## 요약
AWS NACL(Network Access Control List)은 VPC 서브넷 레벨에서 인바운드·아웃바운드 트래픽을 제어하는 stateless 방화벽으로, 규칙 번호(1~32766) 순서대로 평가하고 ALLOW·DENY를 모두 지정할 수 있으며, 인바운드 허용해도 아웃바운드 응답 트래픽(임시 포트 1024-65535)을 별도로 허용해야 하고, 서브넷당 1개만 연결되며 특정 IP 차단·서브넷 간 트래픽 제어·다층 보안(Security Group과 함께)에 활용되고, Security Group(인스턴스 레벨, stateful, ALLOW만)과 달리 서브넷 전체를 보호하고 명시적 차단이 가능하다.
