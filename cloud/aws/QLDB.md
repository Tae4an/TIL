# Amazon Quantum Ledger Database (QLDB)란?

## 개념 정의

Amazon QLDB(Quantum Ledger Database)는 완전관리형 원장 데이터베이스로, 애플리케이션 데이터의 모든 변경 내역을 투명하고 변경 불가능하며 암호화로 검증 가능한 트랜잭션 로그로 저장한다. 중앙 집중식 신뢰 기관이 소유하는 서버리스 데이터베이스로, 블록체인과 달리 분산 합의 없이 빠른 성능을 제공하며, SQL 기반 쿼리 언어(PartiQL)로 데이터를 조회하고 모든 변경 이력을 추적할 수 있다.

쉽게 말해 "모든 데이터 변경을 영구 기록하고 누구도 조작할 수 없는 금융 장부처럼 작동하는 데이터베이스로, 블록체인보다 빠르고 관리가 쉬운 감사 추적 시스템"이다.

## 핵심 특징

- 변경 불가능한 원장 (Immutable Ledger)
- 암호화 검증 가능한 트랜잭션 로그
- 완전한 변경 이력 추적 (시간대별)
- ACID 트랜잭션 지원
- 서버리스 자동 확장
- 블록체인보다 2~3배 빠른 성능
- SQL 기반 PartiQL 쿼리

## 주요 구성 요소

**Ledger (원장)**
- QLDB의 최상위 컨테이너
- 테이블과 저널로 구성
- 리전별로 생성

**Journal (저널)**
- 모든 변경 내역을 순차적으로 기록하는 불변 로그
- Append-Only 구조 (추가만 가능, 수정/삭제 불가)
- 각 변경은 블록으로 저장되고 암호화 해시로 체인 연결
- 데이터를 삭제해도 저널에서 이력 조회 가능

**Table (테이블)**
- 현재 상태의 문서(Document) 저장
- JSON 형식의 문서 모델
- 각 문서는 고유 ID와 버전 정보 포함

**Document Revision (문서 수정본)**
- 문서의 특정 시점 상태
- 메타데이터 (생성 시간, 수정 시간, 버전, 트랜잭션 ID)
- 모든 수정본이 저널에 보존됨

**Digest (다이제스트)**
- 저널 전체의 암호화 해시값
- SHA-256 알고리즘 사용
- 데이터 무결성 검증에 사용

## 작동 방식

1. **트랜잭션 실행**: 애플리케이션이 INSERT, UPDATE, DELETE 실행
2. **저널 기록**: 변경 내역이 저널에 블록으로 추가됨
3. **암호화 체인**: 각 블록에 이전 블록 해시 포함 (블록체인 방식)
4. **테이블 업데이트**: 현재 상태가 테이블에 반영됨
5. **다이제스트 생성**: 전체 저널의 암호화 해시 생성
6. **검증**: 언제든 다이제스트로 데이터 무결성 검증 가능

## 데이터 무결성 검증

### 암호화 검증 프로세스
1. 특정 시점의 다이제스트 조회
2. 검증하려는 문서의 증명(Proof) 요청
3. QLDB가 문서부터 다이제스트까지의 해시 체인 제공
4. 로컬에서 해시 재계산하여 다이제스트와 비교
5. 일치하면 데이터가 조작되지 않았음을 증명

### 감사 추적
- 특정 문서의 전체 변경 이력 조회
- 누가, 언제, 무엇을, 어떻게 변경했는지 추적
- 시간대별 상태 복원 가능

## 주요 활용 사례

**금융 거래 기록**
은행 계좌 거래, 신용카드 결제, 대출 이력을 변경 불가능하게 저장하며, 감사 요구사항을 충족하고 거래 분쟁 시 완전한 이력을 제공한다.

**보험 청구 처리**
보험 청구의 모든 상태 변경을 추적하며, 부정 청구를 방지하고 규제 기관에 투명한 감사 로그를 제공한다.

**공급망 추적**
제품의 원산지부터 최종 소비자까지 이동 경로를 기록하며, 위조품 방지와 리콜 추적을 지원하고 ESG 규정 준수를 입증한다.

**HR 기록 관리**
직원 정보, 급여 변경, 승진 이력을 불변 기록으로 보존하며, 규정 준수와 법적 분쟁 시 증거를 제공한다.

**의료 기록**
환자 진료 기록, 처방 이력, 의료 영상 접근을 추적하며, HIPAA 같은 규정 준수를 보장하고 데이터 무결성을 검증한다.

**규제 보고**
금융 거래, 세금 신고, 감사 로그를 조작 불가능하게 저장하며, 규제 기관에 검증 가능한 증거를 제공한다.

**디지털 자산 소유권**
부동산 등기, 지적재산권, 자격증을 디지털로 관리하며, 소유권 이전 이력을 투명하게 추적한다.

## 통합 서비스

- Amazon Kinesis Data Streams: QLDB 변경 스트리밍
- AWS Lambda: 이벤트 기반 자동화
- Amazon S3: 저널 내보내기
- AWS CloudTrail: API 호출 감사
- Amazon CloudWatch: 모니터링 및 알림
- AWS IAM: 접근 제어
- AWS KMS: 저장 중 암호화

## QLDB vs 블록체인

| 항목 | QLDB | 블록체인 |
|------|------|---------|
| 구조 | 중앙 집중식 | 분산 네트워크 |
| 소유 | 단일 조직 | 여러 참여자 |
| 합의 | 불필요 (신뢰 기관) | 필수 (채굴/투표) |
| 성능 | 매우 빠름 (2~3배) | 느림 (합의 오버헤드) |
| 확장성 | 자동 확장 | 제한적 |
| 쿼리 | SQL (PartiQL) | 복잡한 스크립트 |
| 관리 | AWS 완전관리 | 자체 관리 필요 |
| 비용 | 사용량 기반 | 노드 운영 비용 |
| 투명성 | 조직 내부 | 퍼블릭 가능 |
| 적합 사례 | 중앙 기관 신뢰 환경 | 무신뢰 환경 |

## 언제 QLDB를 사용하는가?

**QLDB 선택 시**
- 중앙 집중식 신뢰 기관이 있음
- 높은 성능과 확장성 필요
- 감사 추적과 데이터 무결성이 중요
- SQL 기반 쿼리가 필요
- AWS 서비스와 통합 필요
- 관리 부담을 최소화하고 싶음

**블록체인 선택 시**
- 탈중앙화가 필수
- 여러 조직이 대등하게 참여
- 무신뢰 환경에서 합의 필요
- 퍼블릭 투명성 필요
- 스마트 컨트랙트 실행 필요

## PartiQL 쿼리 예시

### 데이터 삽입
```sql
INSERT INTO Vehicle VALUE {
  'VIN': '1N4AL11D75C109151',
  'Type': 'Sedan',
  'Owner': 'John Doe'
}
```

### 변경 이력 조회
```sql
SELECT * FROM history(Vehicle) AS v
WHERE v.data.VIN = '1N4AL11D75C109151'
```

### 현재 데이터 조회
```sql
SELECT * FROM Vehicle
WHERE VIN = '1N4AL11D75C109151'
```

## 모범 사례

**적절한 데이터 모델 설계**
문서 구조를 명확히 정의하고, 자주 변경되는 필드와 고정 필드를 구분하며, 중첩 문서로 관련 데이터를 그룹화한다.

**인덱스 최적화**
자주 쿼리하는 필드에 인덱스를 생성하고, 불필요한 인덱스는 제거하여 쓰기 성능을 유지한다.

**배치 작업 활용**
여러 문서를 단일 트랜잭션으로 처리하여 성능을 향상하고, 트랜잭션 비용을 절감한다.

**Kinesis Streams로 변경 스트리밍**
실시간 이벤트 처리가 필요하면 QLDB 스트림을 Kinesis로 전송하고, Lambda로 자동화 워크플로우를 구축한다.

**저널 내보내기**
장기 보관이나 규정 준수를 위해 주기적으로 저널을 S3로 내보내고, Glacier로 아카이브한다.

**데이터 삭제 정책**
현재 테이블 데이터는 삭제 가능하지만 저널 이력은 영구 보존되므로, 삭제 정책을 신중히 설계한다.

**태그 활용**
원장에 태그를 지정하여 비용 추적과 리소스 관리를 체계화한다.

**IAM 최소 권한**
필요한 작업만 허용하는 IAM 정책을 적용하고, 읽기 전용 역할과 쓰기 역할을 분리한다.

## 제약 사항

**중앙 집중식 구조**
AWS가 관리하므로 탈중앙화가 불가능하며, 신뢰 기관이 필요한 환경에만 적합하다.

**삭제 불가능한 저널**
저널은 영구 보존되므로 민감 데이터 저장 시 주의가 필요하며, GDPR 삭제 요청 대응이 복잡하다.

**제한된 쿼리 기능**
복잡한 조인이나 집계는 성능이 제한적이며, 분석 워크로드보다 트랜잭션 워크로드에 적합하다.

**리전 제한**
일부 리전에서만 사용 가능하며, 글로벌 서비스가 아니다.

**PartiQL 학습 곡선**
SQL과 유사하지만 문서 모델 특성상 학습이 필요하다.

## 비용

- 쓰기 요청: $0.000002 per IO (백만 건당 $2)
- 읽기 요청: $0.0000004 per IO (백만 건당 $0.4)
- 저장 용량: $0.10/GB/월 (저널 + 테이블)
- 데이터 전송: 표준 AWS 전송 비용

일반적으로 중소규모 애플리케이션은 월 $50~$200 수준이다.

## 요약

Amazon QLDB는 완전관리형 원장 데이터베이스로, 애플리케이션 데이터의 모든 변경 내역을 투명하고 변경 불가능하며 암호화로 검증 가능한 트랜잭션 로그로 저장하며, 중앙 집중식 신뢰 기관 환경에서 블록체인보다 2~3배 빠른 성능을 제공하고, Append-Only 저널로 모든 이력을 영구 보존하며, 암호화 다이제스트로 데이터 무결성을 검증하고, SQL 기반 PartiQL로 쿼리하며, 서버리스 자동 확장으로 관리 부담이 없고, 금융 거래, 보험 청구, 공급망 추적, HR 기록, 의료 기록, 규제 보고에 최적화되어 있으며, 블록체인과 달리 분산 합의 없이 빠르고 간편하지만 탈중앙화가 불가능하다.
