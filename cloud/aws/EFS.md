# AWS EFS란?

## 개념 정의

AWS EFS(Elastic File System)는 여러 EC2 인스턴스가 동시에 접근할 수 있는 완전관리형 NFS 파일 시스템이다. 파일을 추가/제거하면 용량이 자동으로 확장/축소되며, 페타바이트급까지 확장 가능하고, 여러 가용 영역에 데이터를 저장하여 높은 내구성과 가용성을 제공한다. Linux 기반 워크로드에 최적화되어 있으며, NFS v4 프로토콜을 지원한다.

쉽게 말해 "여러 서버가 동시에 접근하는 공유 네트워크 드라이브로, 파일을 추가하면 자동으로 용량이 늘어나는 탄력적 스토리지"다.

## 핵심 기능

- 자동 확장/축소 (프로비저닝 불필요)
- 수천 개 인스턴스 동시 접근
- 다중 AZ 자동 복제
- NFS v4.0/4.1 프로토콜 지원
- POSIX 호환 파일 시스템
- 암호화 지원 (전송 중/저장 중)
- 수명 주기 관리 (자동 계층 전환)

## 주요 구성 요소

**파일 시스템**
- 실제 파일이 저장되는 논리적 컨테이너
- 리전 단위로 생성
- 고유 파일 시스템 ID (fs-xxxxxxxx)

**마운트 타겟**
- VPC 서브넷마다 생성
- EC2가 EFS에 접근하는 네트워크 진입점
- 각 AZ마다 하나씩 생성 권장
- ENI 형태로 IP 주소 할당

**보안 그룹**
- 마운트 타겟에 연결
- NFS 포트(2049) 제어
- EC2 보안 그룹과 통신 허용

**접근 포인트**
- 애플리케이션별 진입점
- 특정 디렉터리로 루트 제한
- POSIX 사용자/그룹 강제 적용

## EFS 스토리지 클래스

### Standard
- 자주 접근하는 파일용
- 밀리초 이하 지연시간
- 다중 AZ 복제
- 가장 높은 비용

### Standard-IA (Infrequent Access)
- 자주 접근하지 않는 파일용
- 저장 비용 92% 절감
- 접근 시 검색 요금 발생
- 다중 AZ 복제

### One Zone
- 단일 AZ 저장
- Standard 대비 47% 저렴
- 재생성 가능한 데이터에 적합
- 밀리초 이하 지연시간

### One Zone-IA
- 단일 AZ + 저빈도 접근
- 최저 비용 (Standard 대비 92% 절감)
- 백업, 개발/테스트 환경에 적합

### Archive
- 장기 보관용 (연 1-2회 접근)
- 최저 스토리지 비용 (IA 대비 50% 절감)
- 접근 시간: 밀리초~수 분

## 성능 모드

### General Purpose (기본)
- 낮은 지연시간 (250μs 읽기)
- 대부분 워크로드에 적합
- 최대 35,000 IOPS
- 읽기/쓰기 밸런스

### Max I/O (레거시)
- 높은 병렬 처리
- 수만 개 클라이언트 동시 접근
- 약간 높은 지연시간
- 대규모 분석 작업에 적합

## 처리량 모드

### Bursting (기본)
- 파일 시스템 크기에 비례
- 베이스라인: 50 MB/s per TiB
- 버스트: 최대 100 MB/s
- 크레딧 기반 버스팅

### Elastic (권장)
- 자동으로 처리량 확장
- 워크로드에 따라 자동 조정
- 최대 3 GB/s (읽기), 1 GB/s (쓰기)
- 예측 불가능한 워크로드에 적합

### Provisioned
- 고정 처리량 설정
- 파일 시스템 크기와 무관
- 높은 처리량 보장
- 추가 비용 발생

## 주요 기능

### 수명 주기 관리
일정 기간 접근하지 않은 파일을 자동으로 IA 클래스로 이동하며, 7일, 14일, 30일, 60일, 90일 정책 선택 가능하다.

### 암호화
- 저장 중 암호화: KMS 키 사용
- 전송 중 암호화: TLS 1.2
- 파일 시스템 생성 시 설정

### 복제
- 동일 리전 또는 다른 리전으로 자동 복제
- 재해 복구 및 컴플라이언스
- 거의 실시간 동기화

### 파일 시스템 정책
- IAM 기반 접근 제어
- 특정 VPC/계정만 접근 허용
- 루트 접근 제한

### 백업
- AWS Backup 통합
- 자동 백업 스케줄
- 증분 백업으로 비용 절감

## 주요 활용 사례

**웹 서버 콘텐츠 공유**
여러 웹 서버가 동일한 콘텐츠(이미지, CSS, JS)를 공유하며, 업데이트 시 모든 서버에 자동 반영된다.

**컨테이너 스토리지**
ECS, EKS에서 여러 컨테이너가 동일한 파일 시스템을 마운트하며, StatefulSet, 영구 볼륨으로 사용한다.

**홈 디렉터리**
사용자별 홈 디렉터리를 중앙 집중 관리하며, 어떤 인스턴스에서든 동일한 파일에 접근한다.

**빅데이터 분석**
EMR, Spark 클러스터가 공유 데이터셋에 접근하며, 여러 노드가 동시에 처리한다.

**미디어 워크플로우**
동영상 인코딩, 이미지 처리 작업을 여러 워커가 병렬 처리하며, 결과를 공유 스토리지에 저장한다.

**개발/테스트 환경**
여러 개발자가 공통 코드베이스를 공유하며, CI/CD 파이프라인에서 빌드 아티팩트를 저장한다.

**머신러닝 학습**
여러 GPU 인스턴스가 동일한 학습 데이터셋에 접근하며, 체크포인트를 공유 스토리지에 저장한다.

## 통합 서비스

- Amazon EC2: 주요 컴퓨팅 환경
- Amazon ECS/EKS: 컨테이너 영구 볼륨
- AWS Lambda: 함수 간 파일 공유
- AWS Backup: 중앙 백업 관리
- AWS DataSync: 온프레미스 마이그레이션
- AWS Direct Connect/VPN: 온프레미스 접근
- AWS KMS: 암호화 키 관리

## EFS vs EBS vs S3

| 항목 | EFS | EBS | S3 |
|------|-----|-----|-----|
| 유형 | 파일 스토리지 | 블록 스토리지 | 객체 스토리지 |
| 프로토콜 | NFS | 블록 디바이스 | HTTP/HTTPS |
| 동시 접근 | 수천 인스턴스 | 단일 인스턴스 | 무제한 |
| 확장성 | 자동 (페타바이트) | 수동 (16TB) | 무제한 |
| 지연시간 | 밀리초 | 마이크로초 | 밀리초 |
| 처리량 | 10+ GB/s | 2 GB/s | 수십 GB/s |
| 내구성 | 다중 AZ | 단일 AZ | 11 9's |
| 가격 | 높음 | 중간 | 낮음 |
| 사용 사례 | 공유 파일 시스템 | EC2 부팅 볼륨 | 백업, 웹 호스팅 |

## 모범 사례

**Elastic 처리량 모드 사용**
워크로드가 예측 불가능하면 Elastic 모드를 선택하며, 자동으로 처리량이 조정되어 비용과 성능의 균형을 맞춘다.

**수명 주기 정책 설정**
30일 또는 60일 후 IA로 자동 전환하여 비용을 절감하며, 접근 빈도가 낮은 파일을 Archive로 이동한다.

**각 AZ마다 마운트 타겟 생성**
지연시간을 최소화하고 고가용성을 확보하며, AZ 장애 시에도 다른 AZ에서 접근 가능하다.

**보안 그룹 최소 권한**
NFS 포트(2049)를 특정 보안 그룹으로만 제한하며, 불필요한 접근을 차단한다.

**암호화 활성화**
민감 데이터는 저장 중 및 전송 중 암호화를 활성화하며, 규정 준수를 보장한다.

**접근 포인트 활용**
애플리케이션별로 접근 포인트를 생성하여 디렉터리를 격리하고, POSIX 권한을 강제 적용한다.

**CloudWatch 모니터링**
처리량, IOPS, 연결 수를 추적하며, 임계값 초과 시 알람을 설정한다.

**백업 자동화**
AWS Backup으로 일일 자동 백업을 설정하며, 보존 기간을 정의하여 규정 준수를 달성한다.

**One Zone 클래스 검토**
개발/테스트 환경이나 재생성 가능한 데이터는 One Zone으로 비용을 절감한다.

## 제약 사항

**Linux 전용**
NFS 프로토콜을 사용하므로 Windows 네이티브 지원이 없으며, Windows 인스턴스는 NFS 클라이언트 설치 필요하다.

**지연시간**
EBS보다 지연시간이 높으며, 데이터베이스 같은 초저지연 워크로드에는 부적합하다.

**파일 잠금 제한**
NFS 파일 잠금이 제한적이므로, 동시 쓰기가 많은 애플리케이션은 주의가 필요하다.

**성능 병목**
파일 시스템 크기가 작으면 Bursting 모드에서 처리량이 제한될 수 있다.

**비용**
EBS나 S3보다 GB당 비용이 높으며, 사용량이 많으면 비용이 급증한다.

## 비용

**스토리지 비용**
- Standard: $0.30/GB/월
- Standard-IA: $0.025/GB/월
- One Zone: $0.16/GB/월
- One Zone-IA: $0.016/GB/월
- Archive: $0.008/GB/월

**추가 비용**
- IA/Archive 접근 요금: $0.01/GB
- 데이터 전송: 리전 간/인터넷 아웃바운드 유료
- Provisioned Throughput: $6/MB/s/월

## 요약

AWS EFS는 여러 EC2 인스턴스가 동시 접근하는 완전관리형 NFS 파일 시스템으로, 파일 추가/제거 시 자동으로 용량이 확장/축소되며, 다중 AZ에 데이터를 복제하여 높은 가용성과 내구성을 제공하고, Standard, IA, One Zone, Archive 등 5가지 스토리지 클래스로 비용을 최적화하며, Elastic 처리량 모드로 자동 성능 조정이 가능하고, 수명 주기 관리로 자주 접근하지 않는 파일을 자동 계층 전환하며, 웹 서버 콘텐츠 공유, 컨테이너 영구 볼륨, 빅데이터 분석, 미디어 워크플로우에 최적화되어 있고, EBS보다 공유성이 높지만 지연시간이 높으며 S3보다 비싸지만 파일 시스템 인터페이스를 제공한다.
