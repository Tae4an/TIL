# AWS Config란?

## 개념 정의

AWS Config는 AWS 리소스의 구성 설정을 지속적으로 모니터링하고 기록하며 평가하는 완전관리형 서비스다. 리소스가 생성, 수정, 삭제될 때마다 구성 변경 내역을 자동으로 추적하고, 사전 정의된 규칙(Config Rules)으로 규정 준수 여부를 평가하며, 리소스 간 관계를 시각화하고, 특정 시점의 구성 상태를 조회할 수 있다. 감사, 보안 분석, 문제 해결, 규정 준수에 활용된다.

쉽게 말해 "AWS 리소스의 모든 설정 변경을 녹화하는 블랙박스로, 누가 언제 무엇을 어떻게 바꿨는지 추적하고, 보안 규칙에 어긋나면 자동으로 알려주는 감사 도구"다.

## 핵심 특징

- 리소스 구성 변경 이력 자동 기록
- 규정 준수 평가 (Config Rules)
- 리소스 관계 매핑
- 멀티 계정/멀티 리전 집계
- 시간대별 구성 상태 조회
- SNS 알림 통합
- 자동 복구(Remediation) 가능

## 주요 구성 요소

**Configuration Item (구성 항목)**
- 특정 시점의 리소스 구성 스냅샷
- 리소스 ID, 태그, 관계, 메타데이터 포함
- JSON 형식으로 저장
- 변경 발생 시마다 생성

**Configuration Recorder (구성 레코더)**
- 리소스 변경을 감지하고 기록하는 엔진
- 계정당 리전별로 하나씩 실행
- Describe/List API로 리소스 상태 캡처
- S3 버킷에 구성 항목 저장

**Configuration History (구성 이력)**
- 리소스의 모든 구성 변경을 시간순으로 정렬한 목록
- 특정 시점으로 되돌아가 상태 확인 가능
- 문제 해결 및 감사에 활용

**Configuration Snapshot (구성 스냅샷)**
- 특정 시점의 모든 리소스 구성을 한 번에 캡처
- S3에 저장
- 전체 인프라 상태 백업

**Config Rules (구성 규칙)**
- 리소스가 준수해야 할 정책 정의
- 관리형 규칙 (AWS 제공, 300개 이상)
- 사용자 지정 규칙 (Lambda 또는 Guard 언어)
- Compliant(준수) 또는 Non-Compliant(위반) 판정

**Remediation Actions (복구 작업)**
- 규칙 위반 시 자동 수정
- Systems Manager Automation 실행
- Lambda 함수 호출
- 수동 또는 자동 복구 선택

**Aggregator (집계자)**
- 여러 계정과 리전의 Config 데이터 통합
- 중앙 계정에서 전체 조직 모니터링
- Organizations 통합

## 작동 방식

1. **구성 레코더 활성화**: 리전별로 Config 활성화 및 S3 버킷 지정
2. **리소스 감지**: Config가 계정의 모든 리소스 검색
3. **변경 추적**: 리소스 생성/수정/삭제 시 구성 항목 생성
4. **S3 저장**: 구성 항목을 S3 버킷에 저장
5. **규칙 평가**: Config Rules가 구성을 평가하여 준수 여부 판정
6. **SNS 알림**: 위반 감지 시 SNS로 알림 전송
7. **자동 복구**: 설정된 경우 Remediation Action 실행
8. **대시보드 표시**: 콘솔에서 준수 상태 시각화

## Config Rules 유형

### 관리형 규칙 (Managed Rules)
AWS가 사전 정의한 300개 이상의 규칙으로, 일반적인 보안 및 컴플라이언스 요구사항을 커버한다.

**예시**
- `s3-bucket-public-read-prohibited`: S3 버킷 공개 읽기 차단
- `ec2-instance-managed-by-ssm`: EC2가 Systems Manager에 등록되었는지
- `iam-password-policy`: IAM 비밀번호 정책 준수
- `rds-multi-az-support`: RDS Multi-AZ 활성화 여부
- `vpc-flow-logs-enabled`: VPC Flow Logs 활성화 여부

### 사용자 지정 규칙 (Custom Rules)
Lambda 함수 또는 Guard 언어로 직접 작성한 규칙이다.

**Lambda 기반**
Python, Node.js 등으로 복잡한 평가 로직 구현 가능하며, 외부 API 호출 및 고급 검증을 수행한다.

**Guard 기반**
선언적 정책 언어로 간단한 규칙을 빠르게 작성하며, Infrastructure as Code 스타일을 사용한다.

## 트리거 유형

**구성 변경 (Configuration Changes)**
- 리소스 구성이 변경될 때 즉시 평가
- 실시간 위반 감지
- 예: Security Group 규칙 추가 시 즉시 평가

**주기적 (Periodic)**
- 정해진 간격으로 평가 (1시간, 3시간, 6시간, 12시간, 24시간)
- 정적 상태 검증
- 예: 매일 IAM 사용자 MFA 설정 확인

**하이브리드**
- 구성 변경 + 주기적 트리거 결합
- 즉각 대응과 정기 검증을 모두 수행

## 주요 활용 사례

**보안 규정 준수**
S3 버킷 암호화 강제, Security Group 과도한 포트 개방 감지, 루트 사용자 MFA 미설정 알림, 퍼블릭 액세스 차단 확인으로 보안 정책을 지속적으로 검증한다.

**감사 및 컴플라이언스**
PCI DSS, HIPAA, SOC 2 요구사항을 Config Rules로 자동화하며, 감사자에게 준수 이력을 제공하고, 규정 위반을 실시간 감지하여 신속히 대응한다.

**변경 이력 추적**
누가 언제 어떤 리소스를 변경했는지 추적하며, 장애 발생 시 최근 변경 내역을 조회하여 근본 원인을 파악하고, 무단 변경을 감지한다.

**리소스 인벤토리 관리**
전체 AWS 계정의 리소스 목록을 자동 생성하며, 사용하지 않는 리소스를 식별하여 비용을 절감하고, 리소스 간 관계를 시각화하여 의존성을 이해한다.

**재해 복구**
특정 시점의 구성을 조회하여 정상 상태로 복원하며, 장애 전후 구성 변경을 비교 분석하고, 복구 계획 수립에 활용한다.

**자동 복구**
규칙 위반 시 Systems Manager Automation으로 자동 수정하며, 예: 암호화되지 않은 EBS 볼륨 발견 시 자동 암호화, S3 버킷 공개 시 자동 차단으로 사람 개입 없이 보안을 유지한다.

**멀티 계정 거버넌스**
Organizations의 모든 계정을 중앙에서 모니터링하며, 일관된 보안 정책을 조직 전체에 적용하고, 계정별 준수 상태를 대시보드로 확인한다.

## 통합 서비스

- AWS Organizations: 멀티 계정 집계
- AWS CloudTrail: API 호출 이력과 연계
- Amazon S3: 구성 데이터 저장
- Amazon SNS: 알림 전송
- AWS Systems Manager: 자동 복구
- AWS Lambda: 사용자 지정 규칙 및 복구
- AWS Security Hub: 보안 상태 통합
- Amazon CloudWatch Events: 이벤트 기반 자동화

## Config vs CloudTrail vs CloudWatch

| 항목 | Config | CloudTrail | CloudWatch |
|------|--------|-----------|-----------|
| 목적 | 구성 관리 및 규정 준수 | API 호출 감사 | 성능 모니터링 |
| 추적 대상 | 리소스 구성 상태 | API 작업 (누가, 무엇을) | 메트릭, 로그 |
| 질문 | "무엇이 변경되었나?" | "누가 변경했나?" | "성능은 어떤가?" |
| 평가 | 규칙 기반 준수 여부 | 감사 로그 | 임계값 알람 |
| 사용 사례 | 컴플라이언스, 보안 정책 | 보안 감사, 포렌식 | 운영 모니터링 |

## 설정 예시

### S3 암호화 강제 규칙
- 규칙: `s3-bucket-server-side-encryption-enabled`
- 트리거: 구성 변경
- 결과: 암호화 없는 버킷을 Non-Compliant로 표시
- 복구: SSM Automation으로 자동 암호화 활성화

### EC2 보안 그룹 감사
- 규칙: `restricted-ssh`
- 파라미터: 0.0.0.0/0에서 포트 22 차단
- 트리거: 구성 변경
- 결과: 위반 시 SNS 알림 전송

### 주기적 IAM 검증
- 규칙: `iam-user-mfa-enabled`
- 트리거: 24시간 주기
- 결과: MFA 미설정 사용자 식별

## 모범 사례

**모든 리전에서 활성화**
리소스가 있는 모든 리전에서 Config를 활성화하며, 글로벌 서비스(IAM)는 한 리전에서만 기록한다.

**Organizations 통합**
Aggregator로 모든 계정의 데이터를 중앙 집중화하며, 조직 전체의 준수 상태를 단일 대시보드로 관리한다.

**관리형 규칙 우선 사용**
AWS 제공 규칙으로 대부분의 요구사항을 충족하며, 유지 관리 부담을 줄인다.

**자동 복구 설정**
반복적인 위반은 자동 복구로 처리하며, 수동 개입을 최소화한다.

**SNS 알림 구성**
중요 규칙 위반 시 이메일, Slack, PagerDuty로 알림을 전송하며, 신속한 대응을 가능하게 한다.

**S3 수명 주기 설정**
구성 데이터를 S3에 장기 보관하며, 오래된 데이터는 Glacier로 이동하여 비용을 절감한다.

**태그 전략 표준화**
리소스 태그를 일관되게 적용하여 Config 규칙으로 태그 정책을 검증하며, 비용 추적을 강화한다.

**정기 준수 검토**
주간/월간으로 준수 보고서를 검토하고, 반복적인 위반 패턴을 분석하여 근본 원인을 제거한다.

**CloudTrail과 함께 사용**
Config로 "무엇이" 변경되었는지 확인하고, CloudTrail로 "누가" 변경했는지 추적하여 완전한 감사 추적을 구현한다.

## 제약 사항

**사후 감지만 가능**
Config는 리소스가 생성된 후에만 감지하며, 사전 차단은 불가능하다. 예방은 SCP나 IAM Policy로 구현해야 한다.

**지연 시간**
구성 변경이 Config에 반영되기까지 수분 소요되며, 실시간은 아니다.

**비용 발생**
구성 항목 기록, 규칙 평가, S3 저장소에 비용이 발생하며, 대규모 환경에서는 월 수백~수천 달러가 들 수 있다.

**복잡한 규칙 작성**
사용자 지정 규칙은 Lambda 개발 지식이 필요하며, 학습 곡선이 높다.

**글로벌 리소스 중복**
IAM 같은 글로벌 리소스는 여러 리전에서 중복 기록될 수 있으므로, 한 리전에서만 기록하도록 설정해야 한다.

## 비용

- 구성 항목 기록: $0.003 per item
- Config 규칙 평가: $0.001 per evaluation (월 처음 100,000개 무료)
- Conformance Pack 평가: $0.0012 per evaluation
- S3 저장소: 표준 S3 비용
- 일반적으로 중소규모 계정은 월 $50~$200 수준

## 요약

AWS Config는 AWS 리소스의 구성 설정을 지속적으로 모니터링하고 기록하며 평가하는 완전관리형 서비스로, 리소스 생성, 수정, 삭제 시마다 구성 항목을 자동으로 캡처하고 S3에 저장하며, 300개 이상의 관리형 규칙과 Lambda 기반 사용자 지정 규칙으로 규정 준수를 평가하고, 위반 시 SNS 알림과 Systems Manager Automation으로 자동 복구하며, 멀티 계정/멀티 리전 집계로 조직 전체를 중앙 모니터링하고, 보안 규정 준수, 감사, 변경 이력 추적, 리소스 인벤토리 관리, 재해 복구에 최적화되어 있으며, CloudTrail(누가), CloudWatch(성능)와 함께 사용하여 완전한 관찰성을 구현하고, 사후 감지만 가능하며 사전 차단은 SCP/IAM으로 보완해야 한다.
