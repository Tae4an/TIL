# AWS Firewall Manager란?

## 개념 정의
AWS Firewall Manager는 AWS Organizations의 여러 계정과 애플리케이션에 대한 방화벽 규칙을 중앙에서 구성하고 관리할 수 있는 보안 관리 서비스다. 중앙 관리자 계정에서 WAF 규칙, Shield Advanced 보호, Network Firewall 정책, 보안 그룹 규칙, Route 53 Resolver DNS Firewall 등을 통합 관리하며, 기존 리소스와 새로 생성되는 리소스 모두에 보안 정책을 자동으로 적용한다.

쉽게 말해 "수십~수백 개의 AWS 계정에 흩어진 방화벽 설정을 한 곳에서 관리하고, 신규 계정이나 리소스가 생기면 자동으로 보안 정책을 적용해주는 중앙 집중식 보안 관리 서비스"다.

## 핵심 특징

### 중앙 집중식 관리

**단일 관리 지점**
- 중앙 관리자 계정에서 모든 계정의 방화벽 규칙 관리
- AWS Organizations 연동 필수
- 계정별·리전별·리소스별로 정책 적용 범위 지정
- 일관된 보안 정책 유지

**멀티 계정 지원**
- Organizations 내 모든 계정에 정책 배포
- 특정 OU(Organizational Unit)만 선택 가능
- 계정 그룹별 차등 정책 적용

### 자동 정책 적용

**신규 리소스 자동 보호**
- 새 계정이 Organizations에 추가되면 자동으로 정책 적용
- 새 리소스(ALB, CloudFront, EC2 등) 생성 시 즉시 보안 규칙 적용
- 수동 구성 불필요

**규정 준수 자동화**
- 정책 위반 리소스 자동 감지
- 자동 수정(Auto-remediation) 또는 알림
- 지속적인 규정 준수 모니터링

### 여러 보안 서비스 통합 관리

**지원 서비스**
- AWS WAF (Web Application Firewall)
- AWS Shield Advanced (DDoS 보호)
- AWS Network Firewall (네트워크 트래픽 필터링)
- VPC Security Groups (인스턴스 레벨 방화벽)
- Route 53 Resolver DNS Firewall (DNS 필터링)

### 세밀한 정책 범위 제어

**리소스 선택 옵션**
- 계정 선택: 특정 계정, OU, 전체 Organizations
- 리전 선택: 특정 리전만 또는 여러 리전
- 리소스 타입: ALB, API Gateway, CloudFront, EC2 등
- 태그 기반 필터링: 특정 태그가 있는 리소스만 포함/제외

## 주요 정책 유형

### 1. AWS WAF 정책

**기능**
- Application Load Balancer, API Gateway, CloudFront에 WAF 규칙 배포
- SQL 인젝션, XSS 공격 차단
- Rate-based 규칙으로 DDoS 완화
- 관리형 규칙 그룹 또는 커스텀 규칙 사용

**사용 사례**
- 웹 애플리케이션 공통 보호 규칙 적용
- OWASP Top 10 취약점 차단
- 지역별 차단 규칙 (Geo-blocking)
- IP 평판 기반 차단

**예시 시나리오**
- 조직 내 모든 ALB에 SQL 인젝션 방어 규칙 자동 적용
- 새로 배포되는 CloudFront 배포에 Rate Limit 규칙 자동 적용

### 2. AWS Shield Advanced 정책

**기능**
- DDoS 보호를 여러 계정의 리소스에 자동 배포
- ELB, CloudFront, Route 53, Global Accelerator 보호
- 24/7 DDoS 대응 팀 지원
- 비용 보호 (DDoS 공격으로 인한 스케일 아웃 비용 환불)

**사용 사례**
- 중요 애플리케이션에 고급 DDoS 보호 적용
- 글로벌 서비스의 가용성 보장
- 대규모 공격 실시간 감지·완화

### 3. Network Firewall 정책

**기능**
- VPC 경계에 스테이트풀·스테이트리스 방화벽 배포
- IDS/IPS (침입 탐지·방지)
- 도메인 필터링 (허용·차단 도메인 목록)
- 프로토콜·포트 기반 트래픽 제어

**사용 사례**
- VPC 간 East-West 트래픽 검사
- 인터넷 송신 트래픽 필터링
- 악성 도메인 접근 차단
- 규정 준수 요구사항 충족

**예시 시나리오**
- 모든 VPC에서 특정 악성 IP 대역 차단
- 개발 환경에서 프로덕션 DB 접근 차단

### 4. Security Group 정책

**4가지 정책 타입**

#### 공통 보안 그룹 정책 (Common Security Group Policy)
- 기본 보안 그룹을 모든 계정·VPC에 배포
- 기준 규칙 집합 강제
- 애플리케이션별 추가 규칙 허용

**예시**
- 모든 EC2 인스턴스에 SSH 22번 포트를 특정 IP에서만 허용하는 기본 규칙 적용

#### 콘텐츠 감사 정책 (Content Audit Policy)
- 보안 그룹 규칙 감사
- 고위험 규칙 탐지 (예: 0.0.0.0/0 허용)
- 허용되지 않은 프로토콜·포트 식별
- 위반 시 알림 또는 자동 수정

**예시**
- 프로덕션 환경에서 SSH 22번 포트를 0.0.0.0/0으로 열어둔 인스턴스 자동 탐지

#### 사용량 감사 정책 (Usage Audit Policy)
- 사용되지 않는 보안 그룹 식별
- 중복된 보안 그룹 정리
- 일정 기간(예: 30일) 사용 안 된 보안 그룹 리포트

**예시**
- 어떤 ENI에도 연결되지 않은 보안 그룹 목록 생성

#### 기본 보안 그룹 정책 (Primary Security Group Policy)
- 특정 보안 그룹을 여러 계정의 리소스에 복제·연결
- VPC별로 동일한 보안 그룹 자동 생성

### 5. Route 53 Resolver DNS Firewall 정책

**기능**
- DNS 쿼리 수준에서 악성 도메인 차단
- 도메인 허용·차단 목록 관리
- 데이터 유출 방지 (Command & Control 서버 접속 차단)

**사용 사례**
- 피싱 도메인 접근 차단
- 멀웨어 C2 서버 통신 차단
- 기업 정책 위반 도메인 차단 (소셜 미디어, 파일 공유 사이트)

## 작동 방식

### 설정 플로우

**1. 전제 조건**
- AWS Organizations 활성화
- Firewall Manager 관리자 계정 지정
- AWS Config 활성화 (모든 계정·리전)

**2. 정책 생성**
- 정책 타입 선택 (WAF, Shield, Network Firewall, Security Group, DNS Firewall)
- 정책 이름·설명 입력
- 리전 선택

**3. 보안 규칙 정의**
- WAF: 규칙 그룹 선택 또는 생성
- Shield: 리소스 타입 선택
- Network Firewall: 방화벽 정책 구성
- Security Group: 규칙 집합 정의

**4. 적용 범위 지정**
- 계정: 전체 OU, 특정 계정, 계정 제외
- 리소스 타입: ALB, CloudFront, EC2 등
- 태그 필터: 특정 태그 포함/제외

**5. 자동 수정 설정**
- 자동 수정 활성화: 정책 위반 시 자동 수정
- 알림만: 규정 준수 보고서만 생성

**6. 정책 검토 및 생성**
- 설정 검토
- 정책 생성 및 배포

### 자동 적용 예시

**시나리오: 새 계정 추가**
```
1. 신규 계정이 Organizations에 추가됨
2. Firewall Manager가 자동 감지
3. 해당 계정에 정의된 모든 정책 자동 적용
4. WAF 규칙, 보안 그룹, Network Firewall 자동 배포
5. 규정 준수 대시보드에서 상태 확인 가능
```

**시나리오: 새 ALB 생성**
```
1. 개발팀이 특정 계정에 ALB 생성
2. Firewall Manager가 새 리소스 감지
3. WAF 정책에 정의된 규칙 자동 연결
4. 몇 분 내 보호 활성화
5. 정책 위반 시 알림 또는 자동 수정
```

## 주요 활용 사례

### 1. 멀티 계정 WAF 규칙 관리

**시나리오**
- 50개 계정에서 100개 이상의 웹 애플리케이션 운영
- 모든 앱에 OWASP Top 10 방어 규칙 적용 필요

**Firewall Manager 활용**
- 중앙에서 WAF 규칙 그룹 생성
- 모든 ALB, CloudFront에 자동 적용
- 신규 배포 시 자동 보호
- 규칙 업데이트 시 전체 계정에 즉시 반영

### 2. 보안 그룹 거버넌스

**시나리오**
- 수백 개 계정에서 수천 개의 보안 그룹 관리
- 고위험 규칙 (0.0.0.0/0:22) 감사 필요

**Firewall Manager 활용**
- 콘텐츠 감사 정책 생성
- 고위험 규칙 자동 탐지
- 위반 보안 그룹 목록 생성
- 자동 수정 또는 담당자 알림

### 3. VPC 보안 기준선 적용

**시나리오**
- 모든 VPC에 기본 보안 그룹 규칙 적용
- 내부 통신은 허용, 외부 SSH는 특정 IP만 허용

**Firewall Manager 활용**
- 공통 보안 그룹 정책 생성
- 기준 규칙 정의 (Bastion 호스트 IP만 SSH 허용)
- 모든 VPC에 자동 배포
- 개발팀은 추가 규칙만 정의

### 4. DDoS 보호 자동화

**시나리오**
- 중요 서비스에 Shield Advanced 적용
- 신규 서비스 배포 시 자동 보호 필요

**Firewall Manager 활용**
- Shield Advanced 정책 생성
- CloudFront, Route 53, Global Accelerator 자동 보호
- DDoS 공격 실시간 감지·완화
- 대응 팀 자동 연락

### 5. 네트워크 트래픽 필터링

**시나리오**
- 모든 VPC에서 특정 악성 IP 대역 차단
- 인터넷 송신 트래픽 검사

**Firewall Manager 활용**
- Network Firewall 정책 생성
- 도메인 필터링 규칙 정의
- 모든 VPC에 방화벽 자동 배포
- East-West, North-South 트래픽 검사

### 6. DNS 기반 위협 차단

**시나리오**
- 피싱·멀웨어 도메인 접근 차단
- 데이터 유출 방지

**Firewall Manager 활용**
- DNS Firewall 정책 생성
- AWS 관리형 위협 목록 사용
- 커스텀 차단 도메인 추가
- 모든 VPC의 Route 53 Resolver에 적용

## 정책 범위 설정

### 계정 범위

**전체 Organizations**
- 모든 계정에 정책 적용
- 신규 계정 자동 포함

**특정 OU**
- 개발 OU, 프로덕션 OU 등 선택적 적용
- OU 내 신규 계정 자동 포함

**특정 계정만**
- 계정 ID 목록으로 지정
- 신규 계정은 자동 포함 안 됨

**계정 제외**
- 대부분 계정에 적용하되 특정 계정만 제외

### 리소스 범위

**리소스 타입**
- ALB, NLB, CloudFront, API Gateway, EC2 등
- 정책별로 지원 리소스 타입 상이

**태그 기반 필터링**
- 포함 태그: `Environment:Production`인 리소스만 적용
- 제외 태그: `Exemption:True`인 리소스는 제외

**예시: 프로덕션 환경만 보호**
```
계정: Production OU
리전: us-east-1, us-west-2
리소스 타입: Application Load Balancer
태그 포함: Environment:Production
태그 제외: Test:True
```

## 규정 준수 모니터링

### 대시보드

**정책 상태 확인**
- 정책별 규정 준수율
- 준수 리소스 vs 비준수 리소스 수
- 계정별·리전별 상태

**위반 리소스 목록**
- 정책을 준수하지 않는 리소스 식별
- 계정, 리전, 리소스 ID, 위반 이유
- 자동 수정 가능 여부

### 자동 수정

**자동 수정 활성화**
- 정책 생성 시 "Auto-remediation" 옵션 선택
- Firewall Manager가 자동으로 정책 적용

**예시**
- WAF 정책: 규칙이 없는 ALB에 자동으로 WAF WebACL 연결
- 보안 그룹 정책: 고위험 규칙 자동 제거

**수동 수정**
- 자동 수정 비활성화 시 알림만 발송
- 보안팀이 수동으로 검토·수정

### 알림 및 리포팅

**SNS 통합**
- 정책 위반 시 SNS 토픽으로 알림
- 이메일, Slack, PagerDuty 연동

**Security Hub 통합**
- 모든 위반 사항 Security Hub로 전송
- 중앙 집중식 보안 모니터링

**Config 통합**
- AWS Config 규칙으로 규정 준수 추적
- 이력 관리·감사 추적

## 주요 이점

### 1. 운영 효율성

**단일 지점 관리**
- 수백 개 계정의 방화벽을 한 곳에서 관리
- 정책 업데이트 시 전체 계정에 즉시 반영
- 수동 작업 최소화

**자동화**
- 신규 리소스 자동 보호
- 정책 위반 자동 수정
- 지속적 규정 준수

### 2. 일관된 보안 정책

**보안 기준선 강제**
- 모든 계정에 동일한 기준 적용
- 팀별·계정별 편차 방지
- 규정 준수 보장

**계정별 커스터마이징 허용**
- 기본 정책 + 계정별 추가 규칙
- 개발팀 자율성 유지

### 3. 비용 절감

**중앙 관리로 인건비 절감**
- 계정별 수동 설정 불필요
- 보안팀 리소스 효율화

**중복 리소스 제거**
- 사용하지 않는 보안 그룹 정리
- 중복 규칙 통합

### 4. 규정 준수 간소화

**자동 감사**
- 지속적 규정 준수 모니터링
- 위반 사항 즉시 탐지

**리포팅**
- 감사 리포트 자동 생성
- SOC 2, PCI DSS, HIPAA 등 준수 입증

## 제한 사항 및 고려 사항

### 전제 조건

**필수 요구사항**
- AWS Organizations 활성화 필수
- AWS Config 모든 계정·리전에서 활성화
- 관리자 계정 지정 필요

**비용**
- AWS Config 기록 비용
- 각 보안 서비스 별도 비용 (WAF, Shield Advanced, Network Firewall)

### 리전별 정책

**리전 제한**
- 정책은 리전별로 생성
- 글로벌 정책 불가능
- 각 리전마다 별도 정책 생성 필요

**예외: CloudFront, Route 53**
- CloudFront: us-east-1 리전에서만 정책 생성
- Route 53: us-east-1 리전에서만 정책 생성

### 정책 제한

**정책 수 제한**
- 계정당 정책 타입별 제한 있음
- 서비스 한도 증가 요청 가능

**복잡성**
- 너무 많은 정책 생성 시 관리 복잡
- 정책 우선순위 신중히 설정

## 모범 사례

### 1. 계층적 정책 구조

**조직 전체 정책**
- 모든 계정에 적용되는 기본 보안 정책
- 예: OWASP Top 10 방어, SSH 22 차단

**OU별 정책**
- 개발 OU: 덜 엄격한 정책
- 프로덕션 OU: 엄격한 정책
- 금융 OU: 규제 준수 정책

**계정별 예외**
- 특수 요구사항이 있는 계정만 제외

### 2. 점진적 배포

**파일럿 테스트**
- 소수 계정에서 먼저 테스트
- 정책 영향 평가
- 문제 발견 시 조정

**단계적 확장**
- 검증 후 전체 OU로 확대
- 모니터링 강화

### 3. 자동 수정 신중히 사용

**초기: 알림 모드**
- 자동 수정 비활성화
- 위반 사항 검토
- 영향 평가

**검증 후: 자동 수정**
- 정책이 안정화된 후 자동 수정 활성화
- 오탐(False Positive) 최소화

### 4. 태그 전략 수립

**일관된 태깅**
- 모든 리소스에 표준 태그 적용
- Environment, Owner, CostCenter 등

**정책 범위 제어**
- 태그 기반 세밀한 정책 적용
- 유연성 확보

### 5. 모니터링 및 알림 설정

**Security Hub 통합**
- 중앙 집중식 보안 대시보드
- 우선순위 기반 대응

**CloudWatch 알람**
- 정책 위반 건수 모니터링
- 임계값 초과 시 알림

### 6. 정기 정책 검토

**분기별 검토**
- 정책 효과성 평가
- 새로운 위협 반영
- 불필요한 정책 정리

**변경 관리**
- 정책 변경 시 영향 분석
- 롤백 계획 수립

## Firewall Manager vs 수동 관리

| 항목 | Firewall Manager | 수동 관리 |
|------|-----------------|---------|
| 관리 지점 | 중앙 집중식 | 계정별 분산 |
| 신규 리소스 보호 | 자동 | 수동 설정 필요 |
| 정책 일관성 | 보장 | 계정별 편차 발생 |
| 규정 준수 감사 | 자동·지속적 | 수동·주기적 |
| 운영 부담 | 낮음 | 높음 (계정 수에 비례) |
| 확장성 | 우수 | 제한적 |
| 비용 | AWS Config 비용 추가 | 인건비 증가 |
| 적합한 경우 | 멀티 계정 환경 | 단일·소수 계정 |

## 비용

### Firewall Manager 비용

**정책 비용**
- 정책당 월 $100
- 계정당 추가 월 $10 (정책당)

**예시 계산**
- WAF 정책 1개, 20개 계정 적용
- 정책 비용: $100
- 계정 비용: 20 × $10 = $200
- 총 비용: $300/월

### 추가 비용

**AWS Config**
- 구성 항목 기록당 $0.003
- 규칙 평가당 $0.001

**각 서비스 비용**
- AWS WAF: WebACL당 $5/월 + 규칙당 $1/월 + 요청 백만 건당 $0.60
- Shield Advanced: 리소스당 $3,000/월
- Network Firewall: 엔드포인트당 $0.395/시간 + 처리량 GB당 $0.065

## 요약

AWS Firewall Manager는 AWS Organizations의 여러 계정과 리전에 걸쳐 WAF, Shield Advanced, Network Firewall, Security Group, Route 53 DNS Firewall 규칙을 중앙에서 구성·관리하는 보안 관리 서비스로, 신규 계정이나 리소스가 생성될 때 자동으로 보안 정책을 적용하고 지속적으로 규정 준수를 모니터링한다. 중앙 관리자 계정에서 정책 타입 선택, 보안 규칙 정의, 적용 범위 지정(계정, 리전, 리소스 타입, 태그), 자동 수정 설정을 완료하면 전체 조직에 일관된 보안 기준선을 강제할 수 있으며, 콘텐츠 감사 정책으로 고위험 규칙(0.0.0.0/0:22), 사용량 감사 정책으로 미사용 보안 그룹을 자동 탐지하고 Security Hub·SNS·CloudWatch로 알림·리포팅한다. 멀티 계정 WAF 규칙 관리, 보안 그룹 거버넌스, VPC 보안 기준선 적용, DDoS 보호 자동화, 네트워크 트래픽 필터링, DNS 기반 위협 차단 등 다양한 사례에 활용되며, 운영 효율성·일관된 보안 정책·비용 절감·규정 준수 간소화를 제공하지만 AWS Organizations·Config 활성화가 필수이고 정책당 월 $100 + 계정당 $10의 추가 비용이 발생한다.
