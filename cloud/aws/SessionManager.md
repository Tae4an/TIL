# AWS Session Manager란?

## 개념 정의
**AWS Session Manager**는 AWS Systems Manager의 핵심 기능으로 제공되는 **완전 관리형 원격 접속 서비스**다. SSH 키나 RDP 없이 브라우저 기반 셸 또는 AWS CLI를 통해 EC2 인스턴스, 온프레미스 서버, 엣지 디바이스에 안전하게 원격 접속할 수 있다.

간단히 말해 **"클라우드 네이티브 원격 터미널"** 로, 인바운드 포트나 배스천 호스트 없이도 안전하고 감사 가능한 서버 접속을 제공하는 차세대 원격 관리 솔루션 역할을 한다.

## 핵심 특징

### **무포트 보안 접속**
- **인바운드 포트 불필요**: SSH(22), RDP(3389) 포트를 열지 않고도 안전한 접속
- **배스천 호스트 제거**: 중간 점프 서버 없이 프라이빗 서브넷의 인스턴스 직접 접속
- **아웃바운드만**: EC2에서 443 포트 아웃바운드만 허용하면 접속 가능

### **IAM 기반 접근 제어**
- **SSH 키 불필요**: 기존 SSH 키 대신 IAM 권한으로 접속 제어
- **세밀한 권한**: 사용자별, 인스턴스별, 시간별 세부 권한 설정 가능
- **MFA 통합**: 다단계 인증으로 보안 강화

### **완전한 감사 추적**
- **세션 로깅**: 모든 명령과 출력을 S3 또는 CloudWatch Logs에 기록
- **CloudTrail 통합**: 누가 언제 어느 인스턴스에 접속했는지 완전 추적
- **실시간 모니터링**: 진행 중인 세션을 실시간으로 모니터링 및 제어

### **다중 플랫폼 지원**
- **운영체제**: Windows Server, Linux, macOS 모두 지원
- **접속 방법**: 웹 콘솔, AWS CLI, SDK 모든 방식 지원
- **하이브리드**: EC2, 온프레미스, 엣지 디바이스 통합 관리

## 주요 구성 요소

### **SSM Agent**
- **클라이언트 소프트웨어**: 관리 대상 인스턴스에 설치되는 에이전트
- **지속적 폴링**: 5분마다 SSM 서비스와 헬스체크 통신
- **기본 설치**: Amazon Linux 2, Ubuntu, Windows Server AMI에 사전 설치

### **IAM 인스턴스 프로파일**
- **필수 정책**: AmazonSSMManagedInstanceCore 정책 연결 필수
- **권한 관리**: SSM 서비스와 통신할 수 있는 최소 권한 부여
- **보안 경계**: 인스턴스가 수행할 수 있는 작업 범위 정의

### **세션**
- **암호화 통신**: TLS 1.2 기반 클라이언트-인스턴스 간 양방향 통신
- **SigV4 서명**: 연결 요청에 대한 AWS 표준 서명 방식 적용
- **KMS 추가 암호화**: 기본 TLS 외 AWS KMS를 통한 추가 데이터 암호화

### **세션 문서**
- **표준 셸**: 기본 bash, PowerShell 세션 제공
- **포트 포워딩**: 로컬-원격 포트 간 터널링 지원
- **사용자 정의**: 커스텀 세션 유형 및 명령 제한 가능

## 전통적 SSH vs Session Manager 비교

| 특징 | Session Manager | 전통적 SSH/RDP |
|------|-----------------|-----------------|
| **포트 요구사항** | 인바운드 포트 불필요 | SSH(22), RDP(3389) 필수 |
| **키 관리** | IAM 권한 기반 | SSH 키/암호 관리 |
| **네트워크 접근** | 프라이빗 서브넷 직접 | 배스천 호스트 또는 VPN |
| **감사 로깅** | 자동 CloudTrail 기록 | 별도 로깅 솔루션 필요 |
| **접속 방법** | 브라우저/CLI 원클릭 | 터미널 수동 설정 |
| **보안 관리** | 중앙 집중식 IAM | 개별 서버 계정 관리 |

## 주요 기능

### **브라우저 기반 셸**
- **원클릭 접속**: AWS 콘솔에서 "Connect" 버튼으로 즉시 터미널 접속
- **멀티 세션**: 동시에 여러 인스턴스에 개별 세션 연결
- **셸 커스터마이징**: 환경 변수, 작업 디렉터리, 시작 명령 사전 설정

### **포트 포워딩 및 터널링**
- **로컬 포트 포워딩**: 로컬 머신의 포트를 원격 인스턴스 포트로 터널링
- **애플리케이션 접근**: 데이터베이스, 웹 서비스 등에 안전하게 접근
- **프로토콜 지원**: HTTP, HTTPS, 사용자 정의 프로토콜 모두 지원

### **세션 로깅 및 모니터링**
- **S3 저장**: 세션 로그를 S3 버킷에 자동 저장
- **CloudWatch Logs**: 실시간 로그 스트리밍 및 검색
- **암호화 지원**: KMS 키로 로그 데이터 암호화

### **VPC PrivateLink 지원**
- **프라이빗 통신**: VPC 엔드포인트를 통한 AWS 내부 네트워크 통신
- **인터넷 불필요**: 퍼블릭 IP 없이도 Session Manager 사용 가능
- **추가 보안**: 모든 트래픽을 Amazon 백본 네트워크로 제한

## 주요 활용 사례

### **프라이빗 인스턴스 관리**
- 프라이빗 서브넷의 EC2 인스턴스에 배스천 호스트 없이 접속
- VPC 내부 서버의 안전한 유지보수 및 문제 해결
- 네트워크 격리된 환경에서의 운영 작업

### **보안 강화된 원격 작업**
- SSH 포트 완전 차단 상태에서 서버 관리
- 규정 준수가 필요한 환경의 접근 제어
- 모든 관리 작업에 대한 완전한 감사 추적

### **개발 및 디버깅**
- 개발 인스턴스에 빠른 접근으로 실시간 디버깅
- 로그 파일 확인 및 애플리케이션 상태 점검
- 데이터베이스나 내부 서비스에 포트 포워딩으로 접근

### **자동화된 운영**
- 정기적인 시스템 점검 및 유지보수 작업
- 스크립트 실행 및 설정 변경 작업
- 다중 서버 동시 관리 및 모니터링

## 기본 워크플로

### **1. 사전 요구사항 설정**
```bash
# IAM 역할에 필수 정책 연결
aws iam attach-role-policy \
    --role-name EC2-SSM-Role \
    --policy-arn arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
```

### **2. AWS 콘솔에서 세션 시작**
```
AWS Systems Manager Console → Session Manager → Start Session
→ 대상 인스턴스 선택 → Start Session
```

### **3. AWS CLI로 세션 연결**
```bash
# 기본 셸 세션 시작
aws ssm start-session --target i-1234567890abcdef0

# 특정 사용자로 세션 시작
aws ssm start-session \
    --target i-1234567890abcdef0 \
    --document-name AWS-StartSSHSession \
    --parameters 'portNumber=22'
```

### **4. 포트 포워딩 세션**
```bash
# 로컬 8080 포트를 원격 80 포트로 포워딩
aws ssm start-session \
    --target i-1234567890abcdef0 \
    --document-name AWS-StartPortForwardingSession \
    --parameters '{"portNumber":["80"],"localPortNumber":["8080"]}'
```

## 비용 구조

### **기본 기능 (무료)**
- **세션 연결**: 무제한 세션 시작 및 사용 무료
- **기본 로깅**: CloudTrail을 통한 API 호출 기록 무료
- **표준 기능**: 셸 접속, 기본 명령 실행 무료

### **추가 비용 요소**
- **S3 저장**: 세션 로그 S3 저장 시 표준 S3 요금 적용
- **CloudWatch Logs**: 로그 스트리밍 시 CloudWatch Logs 요금
- **VPC 엔드포인트**: PrivateLink 사용 시 VPC 엔드포인트 요금
- **KMS 암호화**: 추가 암호화 시 KMS 키 사용 요금

## 보안 모범 사례

### **IAM 권한 최소화**
- **인스턴스별 접근**: 특정 인스턴스에만 세션 시작 권한 부여[9]
- **시간 제한**: 조건부 IAM 정책으로 특정 시간대만 접근 허용
- **MFA 필수**: 중요 인스턴스 접근 시 다단계 인증 강제

### **네트워크 보안**
- **VPC 엔드포인트**: 인터넷 게이트웨이 없이 프라이빗 통신
- **보안 그룹**: 필요한 아웃바운드 HTTPS(443)만 허용
- **NACL 설정**: 추가적인 네트워크 레벨 접근 제어

### **감사 및 모니터링**
- **세션 로깅 필수**: 모든 세션을 S3 또는 CloudWatch에 기록
- **실시간 알림**: 중요 인스턴스 접속 시 EventBridge를 통한 알림
- **정기 검토**: 세션 로그 정기적 분석으로 이상 행동 탐지

### **운영 보안**
- **세션 타임아웃**: 비활성 세션 자동 종료 설정
- **명령 제한**: 사용자 정의 세션 문서로 실행 가능 명령 제한
- **로그 보존**: 규정 준수 요구사항에 맞는 로그 보존 정책 설정

Session Manager는 **현대적인 클라우드 보안의 핵심**으로, 제로 트러스트 아키텍처와 완전한 감사 추적을 통해 기업이 안전하고 효율적으로 인프라를 관리할 수 있게 하는 필수 서비스다.
