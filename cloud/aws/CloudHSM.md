# AWS CloudHSM란?

## 개념 정의

AWS CloudHSM은 클라우드 기반 하드웨어 보안 모듈(HSM)로, 전용 물리적 하드웨어에서 암호화 키를 생성, 저장, 관리하는 완전관리형 서비스다. FIPS 140-2 Level 3 또는 FIPS 140-3 Level 3 인증을 받은 단일 테넌트 HSM 클러스터를 제공하며, 고객이 암호화 키의 전체 수명 주기를 완전히 제어하고, 업계 표준 API(PKCS#11, JCE, CNG)로 애플리케이션과 통합할 수 있다.

쉽게 말해 "암호화 키를 보관하는 전용 금고 하드웨어를 AWS가 관리해주지만, 키 자체는 고객만 접근할 수 있는 높은 보안 수준의 키 관리 서비스"다.

## 핵심 특징

- 전용 물리적 HSM 하드웨어 (단일 테넌트)
- FIPS 140-2/3 Level 3 인증
- 고객이 암호화 키를 완전히 제어
- 키 내보내기 가능
- VPC 내 배포 (네트워크 격리)
- 다중 AZ 클러스터로 고가용성
- 업계 표준 API 지원

## 주요 구성 요소

**HSM 클러스터**
- 여러 HSM으로 구성된 논리적 그룹
- 최소 2개 HSM 권장 (고가용성)
- 자동 키 복제 및 로드 밸런싱
- 최대 28개 HSM까지 확장

**HSM 인스턴스**
- 물리적 하드웨어 장치 (전용)
- 특정 AZ에 배치
- ENI로 VPC 연결
- 시간당 과금

**암호화 키**
- 대칭키 (AES)
- 비대칭키 (RSA, ECC)
- 최대 3,500개 키 저장 가능
- HSM 내부에서만 생성/사용

**클라이언트**
- EC2 인스턴스에 설치하는 소프트웨어
- HSM과 통신하여 암호화 작업 수행
- PKCS#11, JCE, CNG 라이브러리 제공

## 작동 방식

1. **클러스터 생성**: VPC 서브넷에 CloudHSM 클러스터 생성
2. **HSM 추가**: 각 AZ에 HSM 인스턴스 추가 (최소 2개)
3. **클러스터 초기화**: 최초 관리자 계정 설정
4. **클라이언트 설치**: EC2에 CloudHSM 클라이언트 설치
5. **키 생성**: HSM 내부에서 암호화 키 생성
6. **암호화 작업**: 애플리케이션이 클라이언트를 통해 HSM에 요청
7. **자동 복제**: HSM이 키를 클러스터 내 다른 HSM에 자동 복제
8. **로드 밸런싱**: 클라이언트가 여러 HSM에 작업 분산

## 주요 활용 사례

**금융 거래 보호**
PCI DSS 준수를 위해 신용카드 결제 암호화 키를 HSM에 저장하며, 은행 거래, ATM 암호화, PIN 관리에 사용한다.

**데이터베이스 암호화**
Oracle RDS, SQL Server의 TDE(Transparent Data Encryption) 키를 HSM에 저장하며, Redshift 클러스터 암호화 키를 관리한다.

**PKI 인프라**
디지털 인증서 발급을 위한 루트 CA 키를 HSM에 저장하며, SSL/TLS 인증서 서명, 코드 서명에 사용한다.

**블록체인 및 암호화폐**
디지털 지갑의 프라이빗 키를 HSM에 저장하며, 블록체인 트랜잭션 서명을 보호한다.

**규제 산업 컴플라이언스**
HIPAA, GDPR, PCI DSS 요구사항을 충족하며, 의료 기록, 개인정보, 금융 데이터를 암호화한다.

**코드 서명**
소프트웨어 배포 시 코드 서명 키를 HSM에 보관하며, 펌웨어 업데이트 무결성을 보장한다.

**Custom Key Store (KMS 통합)**
CloudHSM을 KMS의 커스텀 키 스토어로 사용하며, KMS 마스터 키를 HSM에 저장하여 이중 보호를 구현한다.

## 통합 서비스

- AWS KMS: Custom Key Store로 HSM 사용
- Amazon RDS: Oracle, SQL Server TDE 암호화
- Amazon Redshift: 데이터 암호화
- AWS CloudTrail: API 호출 감사
- Amazon CloudWatch: 모니터링 및 알림
- AWS Lambda: 암호화 작업 자동화
- AWS Certificate Manager: 프라이빗 CA 키 저장

## CloudHSM vs KMS

| 항목 | CloudHSM | KMS |
|------|----------|-----|
| 테넌시 | 단일 테넌트 (전용 하드웨어) | 멀티 테넌트 (공유 하드웨어) |
| 키 제어 | 고객이 완전 제어 | AWS와 공유 제어 |
| 키 내보내기 | 가능 | 불가능 |
| FIPS 인증 | Level 3 | Level 3 (2023년 이후) |
| 배포 위치 | VPC 내부 | AWS 관리 인프라 |
| API | PKCS#11, JCE, CNG | AWS KMS API |
| AWS 서비스 통합 | 제한적 (수동 구성) | 광범위 (자동 통합) |
| 고가용성 | 클러스터 수동 구성 | 자동 제공 |
| 비용 | 높음 (시간당 과금) | 낮음 (키/요청당 과금) |
| 사용 편의성 | 복잡 (전문 지식 필요) | 간단 (완전관리) |
| 적합 사례 | 규제 준수, 전용 하드웨어 필요 | 일반 암호화 |

## 언제 CloudHSM을 사용하는가?

**CloudHSM 선택 시**
- FIPS 140-2/3 Level 3 인증이 필수
- 암호화 키의 완전한 제어 필요
- 키를 외부로 내보내기 필요
- 규제 요구사항 (PCI DSS, HIPAA)
- 단일 테넌트 전용 하드웨어 필요
- 커스텀 암호화 알고리즘 사용
- PKI, 코드 서명, 블록체인

**KMS 선택 시**
- 일반적인 암호화 요구사항
- AWS 서비스 통합이 중요
- 관리 부담 최소화
- 비용 최적화
- 빠른 구축 필요

## 지원 API 및 라이브러리

**PKCS#11**
- 암호화 토큰 표준 인터페이스
- C/C++ 애플리케이션
- OpenSSL, Nginx, Apache 통합

**Java Cryptography Extension (JCE)**
- Java 애플리케이션
- 표준 Java 암호화 API 사용

**Microsoft CryptoNG (CNG)**
- Windows 애플리케이션
- .NET, IIS, SQL Server 통합

**OpenSSL Dynamic Engine**
- OpenSSL 기반 애플리케이션
- SSL/TLS 서버 통합

## 모범 사례

**다중 AZ 배포**
최소 2개 AZ에 HSM을 배치하여 고가용성을 확보하며, AZ 장애 시에도 서비스를 지속한다.

**정기 백업**
암호화 키를 정기적으로 백업하며, 재해 복구 계획을 수립하고 테스트한다.

**네트워크 보안 강화**
HSM을 Private Subnet에 배치하고, 보안 그룹으로 접근을 제한하며, VPN/Direct Connect로 온프레미스 연결을 보호한다.

**CloudTrail 감사**
모든 CloudHSM API 호출을 CloudTrail로 로깅하며, 이상 행위를 모니터링하고 알람을 설정한다.

**관리자 계정 보호**
HSM 관리자 계정에 강력한 인증을 적용하며, 역할 분리로 최소 권한 원칙을 구현한다.

**용량 모니터링**
키 저장 용량(최대 3,500개)을 추적하며, 임계값 도달 전 추가 HSM을 프로비저닝한다.

**클라이언트 보안**
EC2 클라이언트를 최신 상태로 유지하고, IAM으로 클라이언트 접근을 제어한다.

**암호화 알고리즘 관리**
업계 표준 알고리즘을 사용하며, 약한 알고리즘은 비활성화한다.

## 제약 사항

**높은 비용**
시간당 과금으로 KMS보다 비싸며, 24x7 운영 시 월 수천 달러가 발생한다.

**VPC 종속성**
VPC 내에서만 작동하므로, VPC 외부 리소스는 VPN/Peering 필요하다.

**수동 관리 필요**
클러스터 확장, 백업, 장애 복구를 수동으로 관리해야 하며, 전문 지식이 필요하다.

**AWS 서비스 통합 제한**
S3, EBS 같은 서비스와 직접 통합이 어려우며, Custom Key Store 또는 SDK 사용이 필요하다.

**리전 제한**
일부 리전에서만 사용 가능하며, 글로벌 서비스가 아니다.

**키 용량 제한**
클러스터당 최대 3,500개 키만 저장 가능하다.

**복잡한 설정**
초기 설정과 통합이 복잡하며, 학습 곡선이 높다.

## 비용

**CloudHSM 인스턴스**
- 시간당 약 $1.45
- 월 24x7 운영 시 약 $1,050 per HSM
- 최소 2개 HSM 권장 → 월 약 $2,100

**추가 비용**
- 데이터 전송: VPC 내 무료, 외부 전송 유료
- CloudTrail 로그: 표준 요금
- CloudWatch 메트릭: 표준 요금

## 요약

AWS CloudHSM은 FIPS 140-2/3 Level 3 인증을 받은 전용 물리적 HSM 하드웨어에서 암호화 키를 생성, 저장, 관리하는 완전관리형 서비스로, 단일 테넌트 환경에서 고객이 키의 전체 수명 주기를 완전히 제어하며, 키 내보내기가 가능하고, VPC 내 배포로 네트워크를 격리하며, 다중 AZ 클러스터로 고가용성을 제공하고, PKCS#11, JCE, CNG 같은 업계 표준 API로 애플리케이션과 통합하며, 금융 거래, 데이터베이스 TDE, PKI, 블록체인, 규제 컴플라이언스에 최적화되어 있고, KMS보다 높은 보안과 제어력을 제공하지만 비용이 높고 설정이 복잡하며 AWS 서비스 통합이 제한적이다.
