# AWS SQS란?

## 개념 정의
**AWS SQS(Simple Queue Service)** 는 **완전 관리형 메시지 큐 서비스**로, 마이크로서비스와 분산 시스템 간에 메시지를 안전하고 확장 가능하게 주고받을 수 있도록 지원한다.

2004년 AWS 최초 출시 서비스로, 애플리케이션 구성 요소를 **느슨하게 결합(Decoupling)** 하여 시스템의 안정성과 확장성을 향상시킨다.

## 핵심 특징

### **비동기 메시징**
- **프로듀서(Producer)** 가 메시지를 큐에 전송하고, **컨슈머(Consumer)** 가 폴링을 통해 메시지를 수신한다
- 실시간 통신이 아닌 **비동기 처리** 방식으로 동작한다
- 메시지는 **최대 14일** 동안 큐에 저장 가능하다

### **완전 관리형 서비스**
- 인프라 관리, 확장, 가용성을 AWS가 모두 처리한다
- **무제한 처리량**과 **무제한 메시지 수** 지원한다
- **99.999999999%(11개의 9) 내구성** 보장한다

### **보안 및 암호화**
- IAM을 통한 액세스 제어와 VPC 엔드포인트 지원한다
- **서버 측 암호화(SSE)** 및 **전송 중 암호화** 제공한다
- 메시지 내용과 메타데이터 모두 보호한다

## 큐 유형

### **Standard Queue (표준 큐)**
- **거의 무제한 처리량** 제공한다
- **최소 1회 전달** 보장하지만 중복 메시지 가능성이 있다
- **Best-Effort 순서**: 대부분 순서를 지키지만 가끔 바뀔 수 있다
- 높은 성능이 우선인 경우에 적합하다

### **FIFO Queue**
- **정확히 1회 전달**과 **엄격한 순서** 보장한다
- **초당 최대 3,000개 메시지** 처리 제한이 있다
- 배치 처리 시 **초당 30,000개 메시지**까지 가능하다
- 순서가 중요한 금융, 결제 시스템에 적합하다

## 폴링 방식

### **Short Polling (기본)**
- 메시지가 없으면 **즉시 빈 응답** 반환한다
- 실시간성은 높지만 **API 호출 비용이 많이** 발생한다
- 메시지가 자주 들어오는 환경에 적합하다

### **Long Polling**
- 메시지가 없으면 **최대 20초까지 대기**한다
- API 호출 횟수를 줄여 **비용을 절약**할 수 있다
- 메시지가 간헐적인 환경에 적합하다

## 주요 기능

### **Dead Letter Queue (DLQ)**
- 처리 실패한 메시지를 **별도 큐에 격리**한다
- **Maximum Receive Count** 설정으로 재시도 횟수 제한한다
- 문제 분석과 수동 재처리가 가능하다

### **Visibility Timeout**
- 메시지 수신 후 **다른 컨슈머가 보지 못하도록** 숨기는 시간이다
- 기본 30초, 최대 12시간까지 설정 가능하다
- 처리 완료 후 메시지를 삭제해야 한다

### **Message Retention**
- 메시지를 **4일(기본) ~ 14일**까지 보관할 수 있다
- 처리되지 않은 메시지도 자동 보관된다

## 주요 활용 사례

### **마이크로서비스 간 통신**
- 서비스 간 **느슨한 결합** 구현한다
- 한 서비스 장애가 다른 서비스에 영향을 주지 않는다
- 독립적인 확장과 배포가 가능하다

### **비동기 작업 처리**
- 이메일 발송, 이미지 처리 등 **시간이 오래 걸리는 작업**을 백그라운드에서 처리한다
- 사용자는 즉시 응답을 받고, 실제 처리는 나중에 수행된다

### **배치 처리**
- 대용량 데이터 처리를 여러 워커로 분산 처리한다
- **Auto Scaling**과 연동하여 워크로드에 따라 워커 수를 조절한다

### **이벤트 기반 아키텍처**
- 시스템 이벤트를 큐에 발행하고, 여러 구독자가 처리한다
- **팬아웃 패턴**으로 하나의 이벤트를 여러 시스템이 처리한다

## 기본 워크플로

### **메시지 전송**
```python
# 메시지 큐에 전송
response = sqs.send_message(
    QueueUrl='queue-url',
    MessageBody='Hello SQS!'
)
```

### **메시지 수신**
```python
# 큐에서 메시지 폴링
messages = sqs.receive_message(
    QueueUrl='queue-url',
    MaxNumberOfMessages=10
)
```

### **메시지 삭제**
```python
# 처리 완료 후 삭제
sqs.delete_message(
    QueueUrl='queue-url',
    ReceiptHandle=receipt_handle
)
```

## 비용 구조

### **요청 기반 과금**
- **API 요청당** 과금 (백만 건당 약 $0.40)
- 첫 백만 건은 **프리 티어**로 무료 제공한다
- Long Polling 사용으로 비용 최적화 가능하다

### **데이터 전송**
- **인터넷으로 나가는** 데이터 전송 시에만 과금한다
- AWS 리전 내 전송은 무료다

## 제한사항

### **메시지 크기**
- 최대 **256KB**까지만 지원한다
- 더 큰 데이터는 **S3와 연동**하여 처리한다

### **FIFO 처리량**
- FIFO 큐는 Standard 큐보다 **처리량이 제한**된다
- 높은 처리량이 필요하면 Standard 큐를 고려해야 한다

## 다른 서비스와의 통합

### **Lambda 연동**
- SQS를 **이벤트 소스**로 Lambda 함수 트리거한다
- 서버리스 비동기 처리 구현이 가능하다

### **SNS와 조합**
- **SNS → SQS** 팬아웃 패턴으로 메시지를 여러 큐에 분산한다
- 다양한 처리 로직을 병렬로 실행할 수 있다

AWS SQS는 **안정적이고 확장 가능한 메시징**을 통해 현대적인 분산 시스템의 핵심 구성 요소 역할을 하는 필수 서비스다.
