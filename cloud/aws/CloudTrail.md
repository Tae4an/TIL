# AWS CloudTrail이란?

## 개념 정의
**AWS CloudTrail**은 AWS 계정의 거버넌스, 규정 준수, 운영 감사 및 위험 감사를 지원하는 서비스다. 사용자, 역할 또는 AWS 서비스가 수행하는 작업을 이벤트로 기록하며, AWS Management Console, AWS CLI, SDK, API에서 수행되는 모든 작업을 추적한다.

간단히 말해, CloudTrail은 AWS 환경에서 **"언제", "누가", "어떤 작업"** 을 수행했는지를 기록하고 저장하는 감시 서비스다.

## 핵심 기능

### **이벤트 기록 및 추적**
- AWS 인프라 전반에 걸친 모든 계정 활동을 자동으로 기록한다
- API 호출, 콘솔 접근, CLI 명령 등 모든 작업이 이벤트로 저장된다
- 각 이벤트는 **15분 안에** CloudTrail에 기록된다

### **자동 활성화**
- AWS 계정 생성 시 자동으로 활성화되어 즉시 로깅을 시작한다
- 별도 설정 없이도 기본 90일간의 이벤트 기록을 제공한다

### **포괄적인 가시성**
- AWS 계정 활동에 대한 완전한 가시성을 확보할 수 있다
- 보안 및 운영 관점에서 매우 중요한 역할을 수행한다

## 이벤트 유형

### **관리 이벤트 (Management Events)**
- AWS 계정의 리소스에서 수행되는 관리 작업 정보를 제공한다
- 제어 영역 작업이라고도 불린다
- 예시: IAM 정책 연결, EC2 인스턴스 생성, VPC 설정, CloudTrail 설정 등
- **기본적으로 로깅**되는 이벤트 유형이다

### **데이터 이벤트 (Data Events)**
- AWS 리소스 내부 또는 리소스 자체에서 수행되는 리소스 작업 정보를 제공한다
- 예시: S3 객체 조작, Lambda 함수 실행 등
- 기본적으로는 로깅되지 않으며, 별도 설정이 필요하다

### **인사이트 이벤트 (Insights Events)**
- 평소와 다른 비정상적인 활동 패턴을 탐지한다
- API 호출률 및 API 오류율의 이상 활동을 식별한다
- CloudTrail Insights 기능으로 제공된다

### **네트워크 활동 이벤트**
- VPC 엔드포인트에 대한 네트워크 활동을 기록한다
- 데이터 경계 개선에 도움을 준다

## 이벤트 기록 정보

각 이벤트에는 다음과 같은 상세 정보가 포함된다:

### **이벤트 정보**
- EventName: 수행된 AWS 작업의 이름
- EventTime: 작업이 수행된 시간과 날짜
- EventSource: 작업을 실행한 AWS 서비스의 이름

### **계정 정보**
- Username: 작업을 수행한 IAM 사용자 또는 역할 이름

### **클라이언트 정보**
- UserAgent: API를 호출한 클라이언트 애플리케이션 정보
- SourceIPAddress: API를 호출한 클라이언트의 IP 주소

### **리소스 정보**
- ResourceType: 작업 대상이 되는 AWS 리소스의 유형
- ResourceName: 작업이 수행된 AWS 리소스의 이름 또는 식별자

## CloudTrail 구성 요소

### **Event History**
- **90일간** 자동으로 저장되는 기본 이벤트 기록이다
- AWS 콘솔에서 손쉽게 최신 이벤트를 확인할 수 있다
- 날짜, 사용자, API 요청 등으로 필터링이 가능하다

### **Trail (트레일)**
- 이벤트를 S3 버킷에 저장하기 위한 구성이다
- 90일 이상 장기간 로그 보관이 가능하다
- 모든 리전에 적용되는 트레일 생성이 가능하다

### **CloudTrail Lake**
- 감사 및 보안 목적의 관리형 데이터 레이크다
- 이벤트를 Apache ORC 형식으로 변환하여 빠른 검색을 지원한다
- **최대 10년**까지 데이터 보존이 가능하다
- SQL 기반 쿼리와 자연어 쿼리를 지원한다

## 주요 사용 사례

### **규정 준수 및 감사**
- SOC, PCI, HIPAA 등 규제 준수를 입증할 수 있다
- 감사 요구사항에 대응하기 위한 상세한 활동 로그를 제공한다

### **보안 강화**
- 사용자 및 API 활동 기록을 통한 보안 태세 개선이 가능하다
- 무단 접근이나 의심스러운 활동을 탐지할 수 있다
- 보안 사고 발생 시 포렌식 분석에 활용할 수 있다

### **운영 관리**
- 시스템 변경사항 추적 및 문제 디버깅에 도움을 준다
- 운영 질문에 대한 답변과 문제 조사를 지원한다
- 대시보드를 통한 트렌드 시각화가 가능하다

## 통합 서비스

### **Amazon S3**
- 트레일 로그의 장기 저장소 역할을 한다
- 90일 이후에도 로그를 보관할 수 있다

### **Amazon CloudWatch**
- CloudWatch Logs 및 Events와 연동하여 실시간 모니터링을 제공한다
- 알람 설정을 통한 이상 활동 탐지가 가능하다

### **Amazon Athena**
- CloudTrail 로그에 대해 SQL 쿼리를 실행할 수 있다
- 대량의 로그 데이터를 분석하는 데 유용하다

## 특징 및 제한사항

### **자동화된 기능**
- 새 리전 추가 시 자동으로 포함되어 이벤트가 로깅된다
- 계정 생성과 동시에 자동 활성화된다

### **로깅 순서**
- 퍼블릭 API 직접 호출의 순서대로 기록되지 않을 수 있다
- 이벤트가 특정 순서로 표시되지 않을 수 있다

### **요금**
- Event History는 무료로 제공된다
- Trail과 CloudTrail Lake는 사용량에 따른 요금이 발생한다

AWS CloudTrail은 AWS 환경의 **완전한 감시와 추적**을 제공하는 핵심 서비스로, 보안, 규정 준수, 운영 관리에 필수적인 도구다.
