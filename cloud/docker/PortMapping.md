# Docker 포트 매핑이란?

**포트 매핑(Port Mapping)** 은 호스트 머신의 특정 포트와 Docker 컨테이너 내부의 포트를 연결하는 기능이다. 이를 통해 외부에서 컨테이너 내부에서 실행되는 서비스에 접근할 수 있게 된다.

## 포트 매핑의 필요성

Docker 컨테이너는 기본적으로 격리된 환경에서 실행된다. 컨테이너 내부에서 웹 서버나 데이터베이스가 실행되더라도, 외부에서는 직접 접근할 수 없다. 포트 매핑을 통해 이러한 격리를 해제하고 외부 접근을 허용하는 것이다.

## 기본 문법

```bash
docker run -p 호스트포트:컨테이너포트 이미지명
```

- `-p` 옵션: 포트 매핑을 위한 옵션
- **호스트포트**: 외부에서 접근할 때 사용하는 포트 번호
- **컨테이너포트**: 컨테이너 내부 서비스가 사용하는 포트 번호

## Nginx를 활용한 포트 매핑 예시

### 기본 포트 매핑

```bash
docker run -d -p 8080:80 nginx
```

이 명령어는 다음과 같이 작동한다:
- 호스트의 8080 포트를 컨테이너 내부의 80 포트에 매핑
- 브라우저에서 `http://localhost:8080` 접속 시 컨테이너 내부의 Nginx 웹 서버로 연결
- Nginx는 기본적으로 80번 포트에서 HTTP 서비스 제공

<img width="1326" height="515" alt="image" src="https://github.com/user-attachments/assets/ccad0a41-346b-4791-a286-59700339cee6" />


### 여러 포트 동시 매핑

```bash
docker run -d -p 8080:80 -p 8443:443 nginx
```

- HTTP(80)와 HTTPS(443) 포트를 동시에 매핑
- `http://localhost:8080`과 `https://localhost:8443`으로 각각 접근 가능

### 특정 IP 주소에 바인딩

```bash
docker run -d -p 127.0.0.1:8080:80 nginx
```

호스트의 특정 IP 주소(127.0.0.1)에서만 접근을 허용하는 설정이다.

## 포트 매핑 동작 원리

### 아키텍처 흐름

```
[브라우저: localhost:8080]
         ↓
[호스트 OS: 8080 포트]
         ↓
[Docker 엔진: 포트 매핑 처리]
         ↓
[컨테이너 내부: nginx 80 포트]
```

1. 클라이언트가 `localhost:8080`으로 요청 전송
2. 호스트 OS가 8080 포트에서 요청 수신
3. Docker 엔진이 포트 매핑 규칙에 따라 컨테이너 내부 80 포트로 전달
4. Nginx가 요청을 처리하고 응답 반환
5. 동일한 경로로 응답이 클라이언트에게 전달

## 포트 매핑 확인 방법

### 실행 중인 컨테이너의 포트 정보 확인

```bash
docker ps
```

출력 예시:
```
CONTAINER ID   IMAGE   PORTS                  NAMES
abc123def456   nginx   0.0.0.0:8080->80/tcp   my-nginx
```

### 특정 컨테이너의 상세 포트 정보

```bash
docker port 컨테이너명
```

## 주의사항 및 베스트 프랙티스

### 포트 충돌 방지

- 호스트에서 이미 사용 중인 포트는 매핑할 수 없다
- 포트 충돌 발생 시 다른 포트 번호를 사용하거나 기존 프로세스를 종료해야 한다

### 보안 고려사항

```bash
# 모든 인터페이스에 바인딩 (보안상 주의 필요)
docker run -d -p 8080:80 nginx

# 로컬호스트에만 바인딩 (더 안전)
docker run -d -p 127.0.0.1:8080:80 nginx
```

### 동적 포트 할당

```bash
docker run -d -P nginx
```

`-P` 옵션을 사용하면 Docker가 자동으로 사용 가능한 호스트 포트를 할당한다.

## 실제 사용 예시

### 개발 환경 구성

```bash
# Nginx 웹 서버
docker run -d -p 8080:80 --name web-server nginx

# 포트 확인
docker ps

# 브라우저에서 http://localhost:8080 접속하여 확인
```

### 컨테이너 내부 파일 수정 후 확인

```bash
# 컨테이너 내부 접속
docker exec -it web-server bash

# HTML 파일 수정
echo "Hello Docker Port Mapping!" > /usr/share/nginx/html/index.html

# 컨테이너 종료
exit

# 브라우저 새로고침으로 변경사항 확인
```

## 정리

포트 매핑은 Docker 컨테이너의 격리된 환경과 외부 세계를 연결하는 핵심 기능이다. `-p` 옵션을 통해 호스트 포트와 컨테이너 포트를 연결함으로써, 외부에서 컨테이너 내부 서비스에 접근할 수 있게 된다. Nginx 같은 웹 서버를 컨테이너로 실행할 때 포트 매핑은 필수적인 설정이며, 올바른 포트 매핑을 통해 개발 환경 구축과 서비스 배포를 효율적으로 수행할 수 있다.
